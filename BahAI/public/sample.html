<!DOCTYPE html>
<html>
<head>
  <title>Real Estate Chat</title>
  <style>
    /* Chat container */
    .chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 350px;
      height: 500px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      z-index: 1000;
    }
    
    .chat-header {
      background: #007bff;
      color: white;
      padding: 15px;
      border-radius: 10px 10px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #f9f9f9;
    }
    
    .message {
      margin: 10px 0;
      padding: 10px 15px;
      border-radius: 15px;
      max-width: 80%;
      word-wrap: break-word;
    }
    
    .sent-message {
      background: #007bff;
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 5px;
    }
    
    .received-message {
      background: #e9ecef;
      margin-right: auto;
      border-bottom-left-radius: 5px;
    }
    
    .message-time {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 5px;
    }
    
    .chat-input {
      padding: 15px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 10px;
    }
    
    .chat-input input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    
    .chat-input button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }
    
    /* User profiles */
    .user-card {
      border: 1px solid #ddd;
      padding: 20px;
      margin: 20px;
      border-radius: 10px;
      max-width: 400px;
    }
    
    /* Chat list */
    .chat-list {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.1);
      padding: 20px;
      z-index: 999;
    }
    
    .conversation-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    
    .conversation-item:hover {
      background: #f5f5f5;
    }
  </style>
</head>
<body>

<h1>Real Estate Website - User Directory</h1>

<!-- Sample User Profiles -->
<div class="user-card">
  <h3>John Smith - Broker</h3>
  <p>Specializes in commercial properties</p>
  <button onclick="startChatWith('user_123', 'John Smith')">
    ðŸ“© Message John
  </button>
</div>

<div class="user-card">
  <h3>Sarah Johnson - Landlord</h3>
  <p>Has 5 properties for rent</p>
  <button onclick="startChatWith('user_456', 'Sarah Johnson')">
    ðŸ“© Message Sarah
  </button>
</div>

<div class="user-card">
  <h3>Mike Wilson - Buyer</h3>
  <p>Looking for 3BHK apartment</p>
  <button onclick="startChatWith('user_789', 'Mike Wilson')">
    ðŸ“© Message Mike
  </button>
</div>

<!-- Chat List (All Conversations) -->
<button onclick="toggleChatList()" style="position:fixed; top:20px; left:20px;">
  ðŸ’¬ All Messages
</button>

<div id="chatList" class="chat-list" style="display:none;">
  <h3>Your Conversations</h3>
  <div id="conversations">
    <!-- Will be populated by JavaScript -->
  </div>
</div>

<!-- Main Chat Window -->
<div id="chatContainer" class="chat-container" style="display:none;">
  <div class="chat-header">
    <span id="chatWithName">Chat with...</span>
    <button onclick="closeChat()" style="background:none;border:none;color:white;font-size:20px;">Ã—</button>
  </div>
  
  <div id="chatMessages" class="chat-messages">
    <!-- Messages appear here -->
  </div>
  
  <div class="chat-input">
    <input type="text" id="messageInput" placeholder="Type your message..." onkeypress="if(event.key=='Enter') sendMessage()">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
  // =========== CHAT SYSTEM ===========
  
  // Store chat data
  let currentChat = {
    withUserId: null,
    withUserName: null,
    chatId: null
  };
  
  // Store all conversations
  let conversations = [];
  
  // Initialize current user (simulated login)
  let currentUser = {
    id: 'current_user_' + Date.now(),
    name: 'You',
    type: 'buyer'
  };
  
  // Save user to localStorage
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
  
  // =========== CHAT FUNCTIONS ===========
  
  // Start chat with a user
  function startChatWith(userId, userName) {
    // Generate chat ID (sorted so user1_user2 is same as user2_user1)
    const chatId = [currentUser.id, userId].sort().join('_');
    
    // Update current chat
    currentChat = {
      withUserId: userId,
      withUserName: userName,
      chatId: chatId
    };
    
    // Show chat window
    document.getElementById('chatContainer').style.display = 'flex';
    document.getElementById('chatWithName').textContent = `Chat with ${userName}`;
    
    // Add to conversations if not already there
    addToConversations(userId, userName, chatId);
    
    // Load messages
    loadMessages(chatId);
    
    // Focus input
    document.getElementById('messageInput').focus();
  }
  
  // Send message
  function sendMessage() {
    const input = document.getElementById('messageInput');
    const messageText = input.value.trim();
    
    if (!messageText || !currentChat.withUserId) {
      alert('Please enter a message');
      return;
    }
    
    // Create message
    const message = {
      id: 'msg_' + Date.now(),
      senderId: currentUser.id,
      receiverId: currentChat.withUserId,
      text: messageText,
      timestamp: new Date().toISOString(),
      chatId: currentChat.chatId,
      read: false
    };
    
    // Display message
    displayMessage(message, 'sent');
    
    // Save to localStorage (in real app, save to database)
    saveMessage(message);
    
    // Clear input
    input.value = '';
    
    // Simulate reply after 1 second
    setTimeout(() => {
      const reply = {
        id: 'msg_' + Date.now(),
        senderId: currentChat.withUserId,
        receiverId: currentUser.id,
        text: getAutoReply(messageText),
        timestamp: new Date().toISOString(),
        chatId: currentChat.chatId,
        read: false
      };
      
      displayMessage(reply, 'received');
      saveMessage(reply);
    }, 1000);
  }
  
  // Display a message
  function displayMessage(message, type) {
    const messagesDiv = document.getElementById('chatMessages');
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}-message`;
    
    const time = new Date(message.timestamp).toLocaleTimeString([], { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    
    messageDiv.innerHTML = `
      <div class="message-text">${message.text}</div>
      <div class="message-time">${time}</div>
    `;
    
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }
  
  // Load messages for a chat
  function loadMessages(chatId) {
    const messagesDiv = document.getElementById('chatMessages');
    messagesDiv.innerHTML = '';
    
    // Get messages from localStorage
    const allMessages = JSON.parse(localStorage.getItem('messages') || '[]');
    const chatMessages = allMessages.filter(m => m.chatId === chatId);
    
    // Display each message
    chatMessages.forEach(msg => {
      const type = msg.senderId === currentUser.id ? 'sent' : 'received';
      displayMessage(msg, type);
    });
    
    // If no messages, show welcome
    if (chatMessages.length === 0) {
      const welcomeMsg = {
        text: `You started a conversation with ${currentChat.withUserName}. Say hello!`,
        timestamp: new Date().toISOString()
      };
      displayMessage(welcomeMsg, 'received');
    }
  }
  
  // Save message to localStorage
  function saveMessage(message) {
    let messages = JSON.parse(localStorage.getItem('messages') || '[]');
    messages.push(message);
    localStorage.setItem('messages', JSON.stringify(messages));
    
    // Update conversation list
    updateConversationList();
  }
  
  // Add to conversations list
  function addToConversations(userId, userName, chatId) {
    // Check if already exists
    const exists = conversations.find(c => c.chatId === chatId);
    
    if (!exists) {
      conversations.push({
        userId: userId,
        userName: userName,
        chatId: chatId,
        lastMessage: '',
        lastMessageTime: new Date().toISOString()
      });
      
      // Save to localStorage
      localStorage.setItem('conversations', JSON.stringify(conversations));
      updateConversationList();
    }
  }
  
  // Update conversation list UI
  function updateConversationList() {
    const convDiv = document.getElementById('conversations');
    convDiv.innerHTML = '';
    
    conversations.forEach(conv => {
      const div = document.createElement('div');
      div.className = 'conversation-item';
      div.innerHTML = `
        <strong>${conv.userName}</strong>
        <div style="font-size:12px;color:#666">Click to open chat</div>
      `;
      
      div.onclick = () => startChatWith(conv.userId, conv.userName);
      convDiv.appendChild(div);
    });
  }
  
  // Toggle chat list visibility
  function toggleChatList() {
    const chatList = document.getElementById('chatList');
    chatList.style.display = chatList.style.display === 'none' ? 'block' : 'none';
  }
  
  // Close chat window
  function closeChat() {
    document.getElementById('chatContainer').style.display = 'none';
  }
  
  // Auto-reply generator
  function getAutoReply(userMessage) {
    const replies = [
      "Thanks for your message! I'll get back to you soon.",
      "That's a great question! Let me check the details for you.",
      "I'm available for a property viewing this weekend. Are you interested?",
      "Yes, that property is still available. Would you like to schedule a visit?",
      "I can provide more photos and documents. What specifically would you like to see?"
    ];
    
    return replies[Math.floor(Math.random() * replies.length)];
  }
  
  // Initialize on page load
  window.onload = function() {
    // Load conversations from localStorage
    conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
    updateConversationList();
    
    // Display current user info
    console.log('Current User:', currentUser);
  };
</script>

</body>
</html>