<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post Property for Rent/Lease</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    /* ===== BASE STYLES (BROKER DASHBOARD THEME) ===== */
    :root {
      --primary: #0b2e52;
      --primary-dark: #001F3F;
      --primary-light: #002f3f;
      --secondary: #1976d2;
      --accent: #ff9800;
      --text-dark: #1a202c;
      --text-light: #718096;
      --bg-light: #f8fafc;
      --bg-white: #ffffff;
      --border: #e2e8f0;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: var(--text-dark);
      min-height: 100vh;
    }

    /* ===== SIDEBAR STYLES ===== */
    .sidebar {
      width: 280px;
      background: var(--primary);
      color: white;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
      transition: all 0.3s ease;
      left: 0;
      top: 0;
    }

    .sidebar.collapsed {
      transform: translateX(-280px);
    }

    .sidebar-header {
      padding: 25px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-header h2 {
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-menu {
      padding: 20px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 20px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border-left-color: var(--accent);
    }

    .menu-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border-left-color: var(--accent);
    }

    .menu-item i {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 20px;
      position: absolute;
      bottom: 0;
      width: 100%;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logout-btn {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ===== MAIN CONTENT CONTAINER ===== */
    .main-content {
      flex: 1;
      padding: 30px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      transition: all 0.3s ease;
      min-height: 100vh;
      width: calc(100% - 280px);
      margin-left: 280px;
    }

    /* When sidebar is collapsed */
    .sidebar.collapsed + .main-content {
      margin-left: 0;
      width: 100%;
    }

    /* Mobile Toggle */
    .mobile-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-dark);
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      background: var(--bg-white);
      box-shadow: var(--shadow);
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 999;
    }

    /* ===== PAGE HEADER ===== */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      gap: 20px;
    }

    .page-title h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
    }

    .page-title p {
      color: var(--text-light);
      font-size: 16px;
      line-height: 1.4;
    }

    .header-actions {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    /* ===== KYC BADGE ===== */
    .kyc-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .kyc-badge.pending {
      background: #feebc8;
      color: #744210;
    }

    .kyc-badge.approved {
      background: #c6f6d5;
      color: #22543d;
    }

    .kyc-badge.rejected {
      background: #fed7d7;
      color: #742a2a;
    }

    /* ===== CARD STYLES ===== */
    .card {
      background: var(--bg-white);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
    }

    /* ===== TYPE SELECTION ===== */
    .type-selection {
      text-align: center;
      margin-bottom: 30px;
    }

    .type-selection h2 {
      color: var(--text-dark);
      margin-bottom: 25px;
      font-size: 24px;
      font-weight: 600;
    }

    .type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .type-card {
      background: var(--bg-white);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .type-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    .type-card.active {
      border-color: var(--primary);
      background: linear-gradient(135deg, rgba(11, 46, 82, 0.05), rgba(0, 47, 63, 0.05));
    }

    .type-icon {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .type-card h3 {
      color: var(--text-dark);
      margin: 10px 0;
      font-size: 20px;
      font-weight: 600;
    }

    .type-card .description {
      color: var(--text-light);
      font-size: 14px;
      line-height: 1.5;
    }

    /* ===== FORM SECTION STYLES ===== */
    .property-details {
      display: none;
    }

    .property-details.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-dark);
      margin: 25px 0 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      color: var(--primary);
    }

    /* ===== FORM GRID & INPUTS ===== */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-dark);
      font-size: 14px;
    }

    .required::after {
      content: " *";
      color: #e53e3e;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      background: var(--bg-white);
      color: var(--text-dark);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(11, 46, 82, 0.1);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    /* ===== INPUT WITH ICON ===== */
    .input-with-icon {
      position: relative;
    }

    .input-with-icon i {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
      font-size: 16px;
    }

    .input-with-icon input,
    .input-with-icon select {
      padding-left: 45px;
    }

    /* ===== AMENITIES GRID ===== */
    .amenities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }

    .amenity-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      background: var(--bg-light);
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .amenity-item:hover {
      background: rgba(11, 46, 82, 0.05);
      transform: translateY(-2px);
    }

    .amenity-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
      accent-color: var(--primary);
    }

    /* ===== IMAGE UPLOAD ===== */
    .image-upload-area {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      background: var(--bg-light);
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
      position: relative;
    }

    .image-upload-area:hover {
      border-color: var(--primary);
      background: rgba(11, 46, 82, 0.05);
      transform: translateY(-2px);
    }

    .image-upload-area i {
      font-size: 48px;
      color: var(--text-light);
      margin-bottom: 15px;
      display: block;
    }

    .image-upload-area p {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-dark);
      margin: 10px 0;
    }

    .image-upload-area .upload-info {
      color: var(--text-light);
      font-size: 13px;
      margin: 5px 0;
    }

    .selected-count {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--primary);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    /* ===== MEDIA PREVIEW ===== */
    .preview-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .preview-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .preview-item:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .preview-item img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      display: block;
    }

    .preview-item video {
      width: 100%;
      height: 120px;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }

    .video-badge {
      position: absolute;
      bottom: 5px;
      left: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: bold;
    }

    .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #e53e3e;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .remove-btn:hover {
      background: #c53030;
      transform: scale(1.1);
    }

    /* ===== BUTTONS ===== */
    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 30px;
      padding-top: 25px;
      border-top: 2px solid var(--border);
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    }

    .btn-secondary {
      background: var(--bg-light);
      color: var(--text-dark);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    /* ===== MESSAGES ===== */
    .message {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 500;
      display: none;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.success {
      background: #c6f6d5;
      color: #22543d;
      border: 1px solid #9ae6b4;
    }

    .message.error {
      background: #fed7d7;
      color: #742a2a;
      border: 1px solid #fc8181;
    }

    .message.warning {
      background: #feebc8;
      color: #744210;
      border: 1px solid #fbd38d;
    }

    /* ===== KYC WARNING ===== */
    .kyc-warning {
      background: linear-gradient(135deg, #feebc8, #fbd38d);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      text-align: center;
      border: none;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .kyc-warning h2 {
      color: #744210;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .kyc-warning a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      margin-top: 15px;
      transition: all 0.3s ease;
    }

    .kyc-warning a:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* ===== MAP STYLES ===== */
    #mapPicker, #leaseMapPicker {
      width: 100%;
      height: 300px;
      border: 2px solid var(--border);
      border-radius: 12px;
      margin-top: 10px;
      margin-bottom: 15px;
    }

    .coordinates-display {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    .coord-box {
      background: var(--bg-light);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid var(--border);
    }

    .coord-box label {
      font-size: 12px;
      color: var(--text-light);
      margin: 0 0 5px 0;
      font-weight: 500;
    }

    .coord-box span {
      display: block;
      font-size: 16px;
      font-weight: 600;
      color: var(--primary);
      font-family: 'Courier New', monospace;
    }

    /* ===== LEASE SPECIFIC STYLES ===== */
    .lease-term-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }

    .lease-option {
      background: var(--bg-white);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .lease-option:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .lease-option.active {
      border-color: var(--primary);
      background: linear-gradient(135deg, rgba(11, 46, 82, 0.05), rgba(0, 47, 63, 0.05));
    }

    /* ===== UPLOAD PROGRESS ===== */
    .upload-progress {
      background: var(--bg-light);
      border: 2px solid var(--primary);
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      display: none;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .upload-progress.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 15px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-280px);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        width: 100%;
        padding: 25px;
      }
      
      .mobile-toggle {
        display: block;
      }
      
      .type-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
      
      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .header-actions {
        width: 100%;
        justify-content: space-between;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 20px;
      }
      
      .card {
        padding: 20px;
      }
      
      .type-grid {
        grid-template-columns: 1fr;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .amenities-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
      
      .lease-term-grid {
        grid-template-columns: 1fr;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
      
      .coordinates-display {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 15px;
      }
      
      .card {
        padding: 20px;
      }
      
      .page-title h1 {
        font-size: 24px;
      }
      
      .section-title {
        font-size: 20px;
      }
      
      .amenities-grid {
        grid-template-columns: 1fr;
      }
      
      .image-upload-area {
        padding: 25px;
      }
      
      .preview-container {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
    }
  </style>
</head>
<body>
  <!-- Mobile Toggle -->
  <button class="mobile-toggle" id="mobileToggle">
    <i class="bi bi-list"></i>
  </button>
  
  <!-- Sidebar will be loaded here -->
  <div id="sidebar-container"></div>
  
  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- Page Header -->
    <div class="page-header">
      <div class="page-title">
        <h1>Add New Property</h1>
        <p>List your property for rent or long-term lease</p>
      </div>
      <div class="header-actions">
        <div id="kycBadge" class="kyc-badge" style="display: none;">
          <i class="bi bi-shield-check"></i>
          <span id="kycBadgeText">KYC Status</span>
        </div>
      </div>
    </div>

    <!-- KYC Warning -->
    <div id="kycWarning" class="kyc-warning" style="display: none;">
      <h2><i class="bi bi-exclamation-triangle"></i> KYC Verification Required</h2>
      <p id="kycStatusText"></p>
      <p id="kycMessage"></p>
      <a href="../kyc.html">
        <i class="bi bi-shield-lock"></i> Complete KYC Verification
      </a>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageBox" class="message" style="display: none;"></div>

    <!-- Type Selection -->
    <div class="card">
      <div class="type-selection">
        <h2>Choose Listing Type</h2>
        <div class="type-grid">
          <div class="type-card active" onclick="selectType('rent')">
            <span class="type-icon"><i class="bi bi-house"></i></span>
            <h3>FOR RENT</h3>
            <div class="description">
              Perfect for residential or commercial spaces available for monthly rental.
            </div>
          </div>
          <div class="type-card" onclick="selectType('lease')">
            <span class="type-icon"><i class="bi bi-file-text"></i></span>
            <h3>FOR LEASE</h3>
            <div class="description">
              Ideal for commercial spaces, land, or special purpose properties for long-term lease.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RENT Form -->
    <div id="rentForm" class="card property-details active">
      <h2 style="color: var(--text-dark); margin-top: 0; margin-bottom: 30px; display: flex; align-items: center; gap: 12px;">
        <i class="bi bi-house"></i> Post Property For Rent
      </h2>
      
      <form id="rentalForm">
        <!-- Basic Information -->
        <h3 class="section-title"><i class="bi bi-info-circle"></i> Basic Information</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="title" class="required">Property Title</label>
            <input type="text" id="title" placeholder="e.g., Modern 2-Bedroom Apartment in BGC" required>
          </div>
          
          <div class="form-group">
            <label for="propertyCategory" class="required">Property Category</label>
            <select id="propertyCategory" required onchange="updatePropertyTypes()">
              <option value="">-- Select Category --</option>
              <option value="residential">Residential Property</option>
              <option value="commercial">Commercial Property</option>
              <option value="industrial">Industrial / Storage</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="propertyType" class="required">Property Type</label>
            <select id="propertyType" required>
              <option value="">-- Select Type --</option>
              <!-- Options populated by JavaScript -->
            </select>
          </div>
        </div>

        <!-- Property Specifications -->
        <h3 class="section-title"><i class="bi bi-rulers"></i> Property Specifications</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="bedrooms" class="required">Bedrooms</label>
            <select id="bedrooms" required>
              <option value="">-- Select --</option>
              <option value="studio">Studio</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5+</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="bathrooms" class="required">Bathrooms</label>
            <select id="bathrooms" required>
              <option value="">-- Select --</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4+</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="floorArea" class="required">Floor Area (sqm)</label>
            <div class="input-with-icon">
              <i class="bi bi-rulers"></i>
              <input type="number" id="floorArea" placeholder="e.g., 75" min="1" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="furnishing">Furnishing</label>
            <select id="furnishing">
              <option value="">-- Select --</option>
              <option value="furnished">Fully Furnished</option>
              <option value="semi-furnished">Semi-Furnished</option>
              <option value="unfurnished">Unfurnished</option>
            </select>
          </div>
        </div>

        <!-- Location -->
        <h3 class="section-title"><i class="bi bi-geo-alt"></i> Location Details</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="address" class="required">Full Address</label>
            <input type="text" id="address" placeholder="Complete address" required>
          </div>
          
          <div class="form-group">
            <label for="city" class="required">City/Municipality</label>
            <input type="text" id="city" placeholder="e.g., Makati City" required>
          </div>
          
          <div class="form-group">
            <label for="province" class="required">Province</label>
            <input type="text" id="province" placeholder="e.g., Metro Manila" required>
          </div>
        </div>
        
        <div class="form-group">
          <label>üìç Pin Location on Map</label>
          <input type="text" id="locationSearch" placeholder="Search address or click on map..." style="margin-bottom: 10px;">
          <div id="mapPicker"></div>
          <div class="coordinates-display">
            <div class="coord-box">
              <label>Latitude</label>
              <span id="latDisplay">Not set</span>
            </div>
            <div class="coord-box">
              <label>Longitude</label>
              <span id="lngDisplay">Not set</span>
            </div>
          </div>
          <input type="hidden" id="latitude" name="latitude">
          <input type="hidden" id="longitude" name="longitude">
        </div>

        <!-- Pricing -->
        <h3 class="section-title"><i class="bi bi-currency-exchange"></i> Pricing Information</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="monthlyRent" class="required">Monthly Rent (‚Ç±)</label>
            <div class="input-with-icon">
              <i class="bi bi-cash-stack"></i>
              <input type="number" id="monthlyRent" placeholder="e.g., 25000" min="1000" step="100" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="securityDeposit">Security Deposit (‚Ç±)</label>
            <div class="input-with-icon">
              <i class="bi bi-bank"></i>
              <input type="number" id="securityDeposit" placeholder="e.g., 25000" min="0" step="100">
            </div>
          </div>
          
          <div class="form-group">
            <label for="advanceRent">Advance Rent (months)</label>
            <div class="input-with-icon">
              <i class="bi bi-calendar-month"></i>
              <input type="number" id="advanceRent" placeholder="e.g., 2" min="1" value="1">
            </div>
          </div>
          
          <div class="form-group">
            <label for="minimumStay" class="required">Minimum Stay (months)</label>
            <div class="input-with-icon">
              <i class="bi bi-calendar-check"></i>
              <input type="number" id="minimumStay" placeholder="e.g., 6" min="1" required value="6">
            </div>
          </div>
        </div>

        <!-- Amenities -->
        <h3 class="section-title"><i class="bi bi-house-door"></i> Amenities</h3>
        <div class="amenities-grid">
          <div class="amenity-item">
            <input type="checkbox" id="wifi" name="amenities" value="Wifi">
            <label for="wifi"><i class="bi bi-wifi"></i> Wifi</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="ac" name="amenities" value="Air Conditioning">
            <label for="ac"><i class="bi bi-snow"></i> Air Conditioning</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="parking" name="amenities" value="Parking">
            <label for="parking"><i class="bi bi-car-front"></i> Parking</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="furniture" name="amenities" value="Furniture">
            <label for="furniture"><i class="bi bi-house"></i> Furniture</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="kitchen" name="amenities" value="Kitchen">
            <label for="kitchen"><i class="bi bi-egg-fried"></i> Kitchen</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="laundry" name="amenities" value="Laundry">
            <label for="laundry"><i class="bi bi-water"></i> Laundry</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="security" name="amenities" value="24/7 Security">
            <label for="security"><i class="bi bi-shield-check"></i> 24/7 Security</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="elevator" name="amenities" value="Elevator">
            <label for="elevator"><i class="bi bi-arrow-up-circle"></i> Elevator</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="pool" name="amenities" value="Swimming Pool">
            <label for="pool"><i class="bi bi-water"></i> Swimming Pool</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="gym" name="amenities" value="Gym">
            <label for="gym"><i class="bi bi-activity"></i> Gym</label>
          </div>
        </div>
        <div class="form-group" style="margin-top: 15px;">
          <label for="otherAmenities">Other Amenities (comma-separated)</label>
          <input type="text" id="otherAmenities" placeholder="e.g., Garden, CCTV, Generator">
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description" class="required">Property Description</label>
          <textarea id="description" placeholder="Describe your property in detail..." rows="6" required></textarea>
        </div>

        <!-- Images & Videos -->
        <h3 class="section-title"><i class="bi bi-images"></i> Property Images & Videos</h3>
        <div class="image-upload-area" onclick="document.getElementById('mediaFiles').click()">
          <i class="bi bi-cloud-arrow-up"></i>
          <p>Upload Property Images & Videos</p>
          <p class="upload-info">Drag & drop or click to browse</p>
          <p class="upload-info">Max 10 files ‚Ä¢ Images: 5MB, Videos: 100MB ‚Ä¢ JPG, PNG, MP4, AVI, MOV</p>
          <div id="imageCount" class="selected-count" style="display: none;">0 files</div>
        </div>
        <input type="file" id="mediaFiles" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia(event)">
        <div class="preview-container" id="previewContainer"></div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="resetRentForm()">
            <i class="bi bi-arrow-clockwise"></i> Reset Form
          </button>
          <button type="submit" class="btn btn-primary" id="submitRentBtn">
            <i class="bi bi-check-circle"></i> Post Property for Rent
          </button>
        </div>
      </form>
    </div>

    <!-- LEASE Form (initially hidden) -->
    <div id="leaseForm" class="card property-details" style="display: none;">
      <h2 style="color: var(--text-dark); margin-top: 0; margin-bottom: 30px; display: flex; align-items: center; gap: 12px;">
        <i class="bi bi-file-text"></i> Post Property For Lease
      </h2>
      
      <form id="leasePropertyForm">
        <!-- Property Category Selection -->
        <h3 class="section-title"><i class="bi bi-buildings"></i> Property Category</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="leasePropertyCategory" class="required">Select Category</label>
            <select id="leasePropertyCategory" required onchange="updateLeasePropertyTypes()">
              <option value="">-- Select Category --</option>
              <option value="commercial">Commercial Property</option>
              <option value="land">Land / Lot</option>
              <option value="special">Special Purpose Property</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="leasePropertyType" class="required">Property Type</label>
            <select id="leasePropertyType" required>
              <option value="">-- Select Type --</option>
              <!-- Options populated by JavaScript -->
            </select>
          </div>
        </div>

        <!-- Basic Information -->
        <h3 class="section-title"><i class="bi bi-info-circle"></i> Basic Information</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="leaseTitle" class="required">Property Title</label>
            <input type="text" id="leaseTitle" placeholder="e.g., Commercial Office Floor in Makati CBD" required>
          </div>
          
          <div class="form-group">
            <label for="totalArea" class="required">Total Area (sqm)</label>
            <div class="input-with-icon">
              <i class="bi bi-rulers"></i>
              <input type="number" id="totalArea" placeholder="e.g., 500" min="1" required step="0.01">
            </div>
          </div>
          
          <div class="form-group">
            <label for="usableArea">Usable Area (sqm)</label>
            <div class="input-with-icon">
              <i class="bi bi-square"></i>
              <input type="number" id="usableArea" placeholder="Optional" min="1" step="0.01">
            </div>
          </div>
          
          <div class="form-group">
            <label for="zoning">Zoning Classification</label>
            <select id="zoning">
              <option value="">-- Select Zoning --</option>
              <option value="commercial">Commercial</option>
              <option value="industrial">Industrial</option>
              <option value="residential">Residential</option>
              <option value="agricultural">Agricultural</option>
              <option value="mixed_use">Mixed Use</option>
              <option value="tourism">Tourism</option>
            </select>
          </div>
        </div>

        <!-- Lease Terms -->
        <h3 class="section-title"><i class="bi bi-calendar-check"></i> Lease Terms</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="leaseType" class="required">Lease Type</label>
            <div class="lease-term-grid">
              <div class="lease-option" onclick="selectLeaseType('gross')">
                <h4>Gross Lease</h4>
                <p style="font-size: 13px; color: var(--text-light);">Rent includes all operating expenses</p>
              </div>
              <div class="lease-option" onclick="selectLeaseType('net')">
                <h4>Net Lease</h4>
                <p style="font-size: 13px; color: var(--text-light);">Tenant pays rent + some expenses</p>
              </div>
              <div class="lease-option" onclick="selectLeaseType('triple-net')">
                <h4>Triple Net (NNN)</h4>
                <p style="font-size: 13px; color: var(--text-light);">Tenant pays all expenses</p>
              </div>
            </div>
            <input type="hidden" id="leaseTypeInput" name="leaseType" required>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="leaseDuration" class="required">Lease Duration</label>
              <select id="leaseDuration" required>
                <option value="">-- Select Duration --</option>
                <option value="1">1 Year</option>
                <option value="2">2 Years</option>
                <option value="3">3 Years</option>
                <option value="5">5 Years</option>
                <option value="10">10 Years</option>
                <option value="15">15+ Years</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="renewalOption">Renewal Option</label>
              <select id="renewalOption">
                <option value="">-- Select Option --</option>
                <option value="automatic">Automatic Renewal</option>
                <option value="negotiable">Negotiable</option>
                <option value="none">No Renewal Option</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Pricing -->
        <h3 class="section-title"><i class="bi bi-cash-stack"></i> Pricing Information</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="annualRent" class="required">Annual Rent (‚Ç±)</label>
            <div class="input-with-icon">
              <i class="bi bi-currency-exchange"></i>
              <input type="number" id="annualRent" placeholder="e.g., 1,200,000" min="10000" step="1000" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="paymentTerms">Payment Terms</label>
            <select id="paymentTerms">
              <option value="">-- Select Terms --</option>
              <option value="monthly">Monthly</option>
              <option value="quarterly">Quarterly</option>
              <option value="semi-annual">Semi-Annual</option>
              <option value="annual">Annual</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="securityBond">Security Bond (‚Ç±)</label>
            <div class="input-with-icon">
              <i class="bi bi-bank"></i>
              <input type="number" id="securityBond" placeholder="e.g., 300,000" min="0" step="1000">
            </div>
          </div>
          
          <div class="form-group">
            <label for="advancePayment">Advance Payment (months)</label>
            <div class="input-with-icon">
              <i class="bi bi-calendar-month"></i>
              <input type="number" id="advancePayment" placeholder="e.g., 3" min="1" value="1">
            </div>
          </div>
        </div>

        <!-- Location Details -->
        <h3 class="section-title"><i class="bi bi-geo-alt"></i> Location Details</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="leaseAddress" class="required">Full Address</label>
            <input type="text" id="leaseAddress" placeholder="Complete address including street, barangay, city" required>
          </div>
          
          <div class="form-group">
            <label for="leaseCity" class="required">City/Municipality</label>
            <input type="text" id="leaseCity" placeholder="e.g., Makati City" required>
          </div>
          
          <div class="form-group">
            <label for="leaseProvince" class="required">Province</label>
            <input type="text" id="leaseProvince" placeholder="e.g., Metro Manila" required>
          </div>
        </div>
        
        <!-- Map -->
        <div class="form-group">
          <label>üìç Pin Location on Map</label>
          <input type="text" id="leaseLocationSearch" placeholder="Search address or click on map..." style="margin-bottom: 10px;">
          <div id="leaseMapPicker"></div>
          <div class="coordinates-display">
            <div class="coord-box">
              <label>Latitude</label>
              <span id="leaseLatDisplay">Not set</span>
            </div>
            <div class="coord-box">
              <label>Longitude</label>
              <span id="leaseLngDisplay">Not set</span>
            </div>
          </div>
          <input type="hidden" id="leaseLatitude" name="leaseLatitude">
          <input type="hidden" id="leaseLongitude" name="leaseLongitude">
        </div>

        <!-- Property Features -->
        <h3 class="section-title"><i class="bi bi-tools"></i> Property Features</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="accessRoad">Access Road Type</label>
            <select id="accessRoad">
              <option value="">-- Select --</option>
              <option value="concrete">Concrete</option>
              <option value="asphalt">Asphalt</option>
              <option value="gravel">Gravel</option>
              <option value="dirt">Dirt Road</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="frontage">Frontage (meters)</label>
            <div class="input-with-icon">
              <i class="bi bi-arrows-expand"></i>
              <input type="number" id="frontage" placeholder="e.g., 20" min="1" step="0.1">
            </div>
          </div>
          
          <div class="form-group">
            <label for="topography">Topography</label>
            <select id="topography">
              <option value="">-- Select --</option>
              <option value="flat">Flat</option>
              <option value="sloping">Sloping</option>
              <option value="hilly">Hilly</option>
              <option value="mountainous">Mountainous</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="utilities">Available Utilities</label>
            <input type="text" id="utilities" placeholder="e.g., Electricity, Water, Internet">
          </div>
        </div>

        <!-- Amenities & Infrastructure -->
        <h3 class="section-title"><i class="bi bi-lightning-charge"></i> Amenities & Infrastructure</h3>
        <div class="amenities-grid">
          <div class="amenity-item">
            <input type="checkbox" id="parking_lease" name="leaseAmenities" value="Parking Area">
            <label for="parking_lease"><i class="bi bi-p-square"></i> Parking Area</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="loading_dock" name="leaseAmenities" value="Loading Dock">
            <label for="loading_dock"><i class="bi bi-truck"></i> Loading Dock</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="security_system" name="leaseAmenities" value="Security System">
            <label for="security_system"><i class="bi bi-shield-lock"></i> Security System</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="fire_safety" name="leaseAmenities" value="Fire Safety System">
            <label for="fire_safety"><i class="bi bi-fire"></i> Fire Safety System</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="backup_power" name="leaseAmenities" value="Backup Power">
            <label for="backup_power"><i class="bi bi-lightning"></i> Backup Power</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="cctv" name="leaseAmenities" value="CCTV">
            <label for="cctv"><i class="bi bi-camera-video"></i> CCTV Surveillance</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="warehouse" name="leaseAmenities" value="Warehouse Space">
            <label for="warehouse"><i class="bi bi-box-seam"></i> Warehouse Space</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="office_space" name="leaseAmenities" value="Office Space">
            <label for="office_space"><i class="bi bi-building"></i> Office Space</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="landscaping" name="leaseAmenities" value="Landscaping">
            <label for="landscaping"><i class="bi bi-tree"></i> Landscaping</label>
          </div>
          <div class="amenity-item">
            <input type="checkbox" id="drainage" name="leaseAmenities" value="Drainage System">
            <label for="drainage"><i class="bi bi-droplet"></i> Drainage System</label>
          </div>
        </div>
        
        <div class="form-group" style="margin-top: 15px;">
          <label for="otherFeatures">Other Features (comma-separated)</label>
          <input type="text" id="otherFeatures" placeholder="e.g., High ceilings, Sprinkler system, Truck access">
        </div>

        <!-- Restrictions & Conditions -->
        <h3 class="section-title"><i class="bi bi-file-earmark-lock"></i> Restrictions & Conditions</h3>
        <div class="form-group">
          <label for="restrictions">Use Restrictions</label>
          <textarea id="restrictions" placeholder="Describe any use restrictions, zoning limitations, or special conditions..." rows="4"></textarea>
        </div>
        
        <div class="form-group">
          <label for="maintenance">Maintenance Responsibility</label>
          <select id="maintenance">
            <option value="">-- Select Responsibility --</option>
            <option value="landlord">Landlord</option>
            <option value="tenant">Tenant</option>
            <option value="shared">Shared</option>
          </select>
        </div>

        <!-- Property Description -->
        <div class="form-group">
          <label for="leaseDescription" class="required">Property Description</label>
          <textarea id="leaseDescription" placeholder="Describe the property in detail, including development potential, nearby landmarks, transportation access, etc." rows="6" required></textarea>
        </div>

        <!-- Images & Videos -->
        <h3 class="section-title"><i class="bi bi-images"></i> Property Images & Videos</h3>
        <div class="image-upload-area" onclick="document.getElementById('leaseMediaFiles').click()">
          <i class="bi bi-cloud-arrow-up"></i>
          <p>Upload Property Images & Videos</p>
          <p class="upload-info">Drag & drop or click to browse</p>
          <p class="upload-info">Max 10 files ‚Ä¢ Images: 5MB, Videos: 100MB ‚Ä¢ JPG, PNG, MP4, AVI, MOV</p>
          <div id="leaseImageCount" class="selected-count" style="display: none;">0 files</div>
        </div>
        <input type="file" id="leaseMediaFiles" accept="image/*,video/*" multiple style="display: none;" onchange="previewLeaseMedia(event)">
        <div class="preview-container" id="leasePreviewContainer"></div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="resetLeaseForm()">
            <i class="bi bi-arrow-clockwise"></i> Reset Form
          </button>
          <button type="submit" class="btn btn-primary" id="submitLeaseBtn">
            <i class="bi bi-check-circle"></i> Post Property for Lease
          </button>
        </div>
      </form>
    </div>

    <!-- Upload Progress for Rent -->
    <div id="uploadProgress" class="upload-progress" style="display: none;">
      <h3 style="margin-top: 0; color: var(--text-dark); display: flex; align-items: center; gap: 10px;">
        <i class="bi bi-cloud-arrow-up"></i> Uploading Property...
      </h3>
      <p id="progressText">Preparing upload...</p>
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
      </div>
    </div>

    <!-- Upload Progress for Lease -->
    <div id="leaseUploadProgress" class="upload-progress" style="display: none;">
      <h3 style="margin-top: 0; color: var(--text-dark); display: flex; align-items: center; gap: 10px;">
        <i class="bi bi-cloud-arrow-up"></i> Uploading Lease Property...
      </h3>
      <p id="leaseProgressText">Preparing upload...</p>
      <div class="progress-bar">
        <div id="leaseProgressFill" class="progress-fill" style="width: 0%;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Firebase & Maps Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwwAkIEixeUysaGrMb9BtTsMwz_C9Noxk&libraries=places" async defer></script>

<script>
  // ===== CONFIGURATION =====
  const firebaseConfig = {
    apiKey: "AIzaSyCIfzneDzWVveG8p_0mywoA9D9F5AyzZX4",
    authDomain: "bahai-1b76d.firebaseapp.com",
    projectId: "bahai-1b76d",
    storageBucket: "bahai-1b76d.firebasestorage.app",
    messagingSenderId: "646878644941",
    appId: "1:646878644941:web:5b4ccc3412250337587784"
  };

  // ===== LOAD SIDEBAR =====
  async function loadSidebar() {
    try {
      const response = await fetch('sidebar.html');
      const sidebarHtml = await response.text();
      document.getElementById('sidebar-container').innerHTML = sidebarHtml;
      
      // Initialize sidebar after loading
      initializeSidebar();
    } catch (error) {
      console.error('Error loading sidebar:', error);
      // Fallback to basic sidebar if loading fails
      document.getElementById('sidebar-container').innerHTML = `
        <div class="sidebar" id="sidebar">
          <div class="sidebar-header">
            <h2><i class="bi bi-house"></i> PropHub</h2>
          </div>
          
          <div class="sidebar-menu">
            <a href="landlord_dashboard.html" class="menu-item">
              <i class="bi bi-speedometer2"></i>
              <span class="menu-text">Dashboard</span>
            </a>
            <a href="landlord_listings.html" class="menu-item">
              <i class="bi bi-list-ul"></i>
              <span class="menu-text">My Properties</span>
            </a>
            <a href="#" class="menu-item active">
              <i class="bi bi-plus-circle"></i>
              <span class="menu-text">Add Property</span>
            </a>
            <a href="../kyc.html" class="menu-item">
              <i class="bi bi-shield-check"></i>
              <span class="menu-text">KYC Verification</span>
            </a>
          </div>
          
          <div class="sidebar-footer">
            <button class="logout-btn" id="sidebarLogoutBtn">
              <i class="bi bi-box-arrow-right"></i> Logout
            </button>
          </div>
        </div>
      `;
      initializeSidebar();
    }
  }

  function initializeSidebar() {
    // Setup logout button
    const logoutBtn = document.getElementById('sidebarLogoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function() {
        firebase.auth().signOut().then(() => {
          window.location.href = "../login.html";
        });
      });
    }
    
    // Mark current page as active
    const currentPage = window.location.pathname.split('/').pop();
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
      const href = item.getAttribute('href');
      if (href && href.includes(currentPage)) {
        item.classList.add('active');
      } else {
        item.classList.remove('active');
      }
    });
  }

  // ===== SIDEBAR FUNCTIONS =====
  function toggleMobileSidebar() {
    const sidebar = document.getElementById('sidebar');
    if (sidebar) {
      sidebar.classList.toggle('active');
    }
  }

  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    if (sidebar) {
      sidebar.classList.toggle('collapsed');
    }
  }

  // ===== INITIALIZE =====
  document.addEventListener('DOMContentLoaded', function() {
    // Load sidebar first
    loadSidebar();
    
    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    
    // Check authentication
    firebase.auth().onAuthStateChanged(async function(user) {
      if (!user) {
        window.location.href = "../login.html";
        return;
      }
      currentUser = user;
      await loadUserProfile();
      await checkKYCStatus();
    });
    
    // Initialize forms
    initializeRentForm();
    initializeLeaseForm();
    
    // Setup mobile toggle
    document.getElementById('mobileToggle').addEventListener('click', toggleMobileSidebar);
  });

  // ===== RENT PROPERTY TYPE MAPPING =====
  const propertyTypes = {
    residential: [
      { value: "apartment", label: "Apartment Unit" },
      { value: "boarding_house", label: "Boarding House" },
      { value: "condo", label: "Condominium Unit" },
      { value: "room", label: "Room / Bedspace" },
      { value: "townhouse", label: "Townhouse" },
      { value: "house", label: "House" },
      { value: "dormitory", label: "Dormitory" }
    ],
    commercial: [
      { value: "office_unit", label: "Office Unit" },
      { value: "retail_space", label: "Retail Space" },
      { value: "food_stall", label: "Food Stall / Kiosk" },
      { value: "shop", label: "Shop" },
      { value: "showroom", label: "Showroom" }
    ],
    industrial: [
      { value: "warehouse", label: "Warehouse" },
      { value: "storage_unit", label: "Storage Unit" },
      { value: "factory", label: "Factory" },
      { value: "workshop", label: "Workshop" }
    ]
  };

  // ===== LEASE PROPERTY TYPE MAPPING =====
  const leasePropertyTypes = {
    commercial: [
      { value: "office_floor", label: "Office Floor" },
      { value: "retail_space_lease", label: "Retail Space" },
      { value: "building_lease", label: "Building Lease" },
      { value: "commercial_unit", label: "Commercial Unit" },
      { value: "showroom_lease", label: "Showroom" },
      { value: "warehouse_lease", label: "Warehouse" }
    ],
    land: [
      { value: "commercial_lot", label: "Commercial Lot" },
      { value: "agricultural_land", label: "Agricultural Land" },
      { value: "development_land", label: "Development Land" },
      { value: "industrial_lot", label: "Industrial Lot" },
      { value: "residential_lot", label: "Residential Lot" },
      { value: "vacant_lot", label: "Vacant Lot" }
    ],
    special: [
      { value: "resort_property", label: "Resort Property" },
      { value: "event_venue", label: "Event Venue" },
      { value: "parking_area", label: "Parking Area" },
      { value: "school_property", label: "School Property" },
      { value: "hospitality", label: "Hospitality Property" },
      { value: "sports_facility", label: "Sports Facility" }
    ]
  };

  // ===== GLOBAL VARIABLES =====
  let currentUser = null;
  let kycStatus = null;
  let map, marker, autocomplete;
  let leaseMap, leaseMarker, leaseAutocomplete;
  let selectedImages = [];
  let selectedLeaseImages = [];
  let selectedLeaseType = null;

  // ===== USER PROFILE =====
  async function loadUserProfile() {
    try {
      const userDoc = await firebase.firestore().collection('users').doc(currentUser.uid).get();
      if (userDoc.exists) {
        const userData = userDoc.data();
        // You can use user data if needed
      }
    } catch (error) {
      console.error('Error loading user profile:', error);
    }
  }

  // ===== TYPE SELECTION =====
  function selectType(type) {
    // Update UI
    document.querySelectorAll('.type-card').forEach(card => {
      card.classList.remove('active');
    });
    
    const clickedCard = event.currentTarget;
    clickedCard.classList.add('active');
    
    // Show appropriate form
    if (type === 'rent') {
      document.getElementById('rentForm').style.display = 'block';
      document.getElementById('leaseForm').style.display = 'none';
      
      // Initialize rent map if not already done
      if (window.google && window.google.maps && !map) {
        setTimeout(() => initMapPicker(), 100);
      }
    } else {
      document.getElementById('rentForm').style.display = 'none';
      document.getElementById('leaseForm').style.display = 'block';
      
      // Initialize lease map if not already done
      if (window.google && window.google.maps && !leaseMap) {
        setTimeout(() => initLeaseMapPicker(), 100);
      }
    }
  }

  // ===== RENT FORM FUNCTIONS =====
  function initializeRentForm() {
    // Update property types when category changes
    document.getElementById('propertyCategory').addEventListener('change', updatePropertyTypes);
    
    // Initialize map when Google Maps loads
    if (window.google && window.google.maps) {
      initMapPicker();
    } else {
      window.addEventListener('load', function() {
        if (window.google && window.google.maps && !map) {
          initMapPicker();
        }
      });
    }
    
    // Form submission
    document.getElementById('rentalForm').addEventListener('submit', handleRentSubmit);
  }

  function updatePropertyTypes() {
    const category = document.getElementById('propertyCategory').value;
    const typeSelect = document.getElementById('propertyType');
    
    // Clear existing options
    typeSelect.innerHTML = '<option value="">-- Select Type --</option>';
    
    // Add new options based on category
    if (category && propertyTypes[category]) {
      propertyTypes[category].forEach(type => {
        const option = document.createElement('option');
        option.value = type.value;
        option.textContent = type.label;
        typeSelect.appendChild(option);
      });
    }
  }

  // ===== LEASE FORM FUNCTIONS =====
  function initializeLeaseForm() {
    // Update property types when category changes
    document.getElementById('leasePropertyCategory').addEventListener('change', updateLeasePropertyTypes);
    
    // Initialize lease type selection
    document.querySelectorAll('.lease-option').forEach(option => {
      option.addEventListener('click', function() {
        selectLeaseType(this.querySelector('h4').textContent.toLowerCase().replace(/\s+/g, '_'));
      });
    });
    
    // Form submission
    document.getElementById('leasePropertyForm').addEventListener('submit', handleLeaseSubmit);
  }

  function updateLeasePropertyTypes() {
    const category = document.getElementById('leasePropertyCategory').value;
    const typeSelect = document.getElementById('leasePropertyType');
    
    // Clear existing options
    typeSelect.innerHTML = '<option value="">-- Select Type --</option>';
    
    // Add new options based on category
    if (category && leasePropertyTypes[category]) {
      leasePropertyTypes[category].forEach(type => {
        const option = document.createElement('option');
        option.value = type.value;
        option.textContent = type.label;
        typeSelect.appendChild(option);
      });
    }
  }

  function selectLeaseType(type) {
    selectedLeaseType = type;
    document.getElementById('leaseTypeInput').value = type;
    
    // Update UI
    document.querySelectorAll('.lease-option').forEach(option => {
      option.classList.remove('active');
    });
    
    event.currentTarget.classList.add('active');
  }

  // ===== MEDIA HANDLING (Images & Videos) =====
  function previewMedia(event) {
    const files = event.target.files;
    const container = document.getElementById('previewContainer');
    const countElement = document.getElementById('imageCount');
    
    // Add new files to existing array
    const newFiles = Array.from(files);
    const totalFiles = selectedImages.length + newFiles.length;
    
    // Check if total exceeds 10
    if (totalFiles > 10) {
      showMessage(`Maximum 10 files allowed. You already have ${selectedImages.length} files.`, 'error');
      event.target.value = '';
      return;
    }
    
    // Check file sizes
    for (const file of newFiles) {
      if (file.type.startsWith('image/') && file.size > 5 * 1024 * 1024) {
        showMessage(`Image "${file.name}" exceeds 5MB limit. Please choose smaller files.`, 'error');
        event.target.value = '';
        return;
      }
      if (file.type.startsWith('video/') && file.size > 100 * 1024 * 1024) {
        showMessage(`Video "${file.name}" exceeds 100MB limit. Please choose smaller files.`, 'error');
        event.target.value = '';
        return;
      }
    }
    
    // Add new files to the array
    selectedImages.push(...newFiles);
    
    // Update UI
    updateMediaPreview('rent');
    
    // Update count display
    if (selectedImages.length > 0) {
      countElement.textContent = `${selectedImages.length} file(s)`;
      countElement.style.display = 'block';
    }
    
    // Reset file input so same files can be selected again
    event.target.value = '';
  }

  function previewLeaseMedia(event) {
    const files = event.target.files;
    const container = document.getElementById('leasePreviewContainer');
    const countElement = document.getElementById('leaseImageCount');
    
    // Add new files to existing array
    const newFiles = Array.from(files);
    const totalFiles = selectedLeaseImages.length + newFiles.length;
    
    // Check if total exceeds 10
    if (totalFiles > 10) {
      showMessage(`Maximum 10 files allowed. You already have ${selectedLeaseImages.length} files.`, 'error');
      event.target.value = '';
      return;
    }
    
    // Check file sizes
    for (const file of newFiles) {
      if (file.type.startsWith('image/') && file.size > 5 * 1024 * 1024) {
        showMessage(`Image "${file.name}" exceeds 5MB limit. Please choose smaller files.`, 'error');
        event.target.value = '';
        return;
      }
      if (file.type.startsWith('video/') && file.size > 100 * 1024 * 1024) {
        showMessage(`Video "${file.name}" exceeds 100MB limit. Please choose smaller files.`, 'error');
        event.target.value = '';
        return;
      }
    }
    
    // Add new files to the array
    selectedLeaseImages.push(...newFiles);
    
    // Update UI
    updateMediaPreview('lease');
    
    // Update count display
    if (selectedLeaseImages.length > 0) {
      countElement.textContent = `${selectedLeaseImages.length} file(s)`;
      countElement.style.display = 'block';
    }
    
    // Reset file input so same files can be selected again
    event.target.value = '';
  }

  function updateMediaPreview(formType) {
    const container = formType === 'rent' ? document.getElementById('previewContainer') : document.getElementById('leasePreviewContainer');
    const countElement = formType === 'rent' ? document.getElementById('imageCount') : document.getElementById('leaseImageCount');
    const images = formType === 'rent' ? selectedImages : selectedLeaseImages;
    
    // Clear existing preview
    container.innerHTML = '';
    
    if (images.length === 0) {
      countElement.style.display = 'none';
      return;
    }
    
    // Create preview for each file
    images.forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const div = document.createElement('div');
        div.className = 'preview-item';
        
        if (file.type.startsWith('video/')) {
          div.innerHTML = `
            <video controls>
              <source src="${e.target.result}" type="${file.type}">
              Your browser does not support the video tag.
            </video>
            <button type="button" class="remove-btn" onclick="${formType === 'rent' ? 'removeImage' : 'removeLeaseImage'}(${index})">√ó</button>
            <div class="video-badge">VIDEO</div>
          `;
        } else {
          div.innerHTML = `
            <img src="${e.target.result}" alt="Preview ${index + 1}">
            <button type="button" class="remove-btn" onclick="${formType === 'rent' ? 'removeImage' : 'removeLeaseImage'}(${index})">√ó</button>
          `;
        }
        container.appendChild(div);
      };
      reader.readAsDataURL(file);
    });
    
    // Update count
    countElement.textContent = `${images.length} file(s)`;
    countElement.style.display = 'block';
  }

  function removeImage(index) {
    selectedImages.splice(index, 1);
    updateMediaPreview('rent');
  }

  function removeLeaseImage(index) {
    selectedLeaseImages.splice(index, 1);
    updateMediaPreview('lease');
  }

  // ===== MAP FUNCTIONS =====
  window.initMapPicker = function() {
    const defaultLocation = { lat: 14.5995, lng: 120.9842 };
    
    map = new google.maps.Map(document.getElementById('mapPicker'), {
      center: defaultLocation,
      zoom: 12,
      mapTypeControl: true,
      streetViewControl: true,
      styles: [
        {
          "featureType": "administrative",
          "elementType": "geometry",
          "stylers": [{"visibility": "off"}]
        },
        {
          "featureType": "poi",
          "stylers": [{"visibility": "off"}]
        },
        {
          "featureType": "road",
          "elementType": "labels.icon",
          "stylers": [{"visibility": "off"}]
        },
        {
          "featureType": "transit",
          "stylers": [{"visibility": "off"}]
        }
      ]
    });
    
    const input = document.getElementById('locationSearch');
    autocomplete = new google.maps.places.Autocomplete(input);
    autocomplete.bindTo('bounds', map);
    
    autocomplete.addListener('place_changed', function() {
      const place = autocomplete.getPlace();
      if (place.geometry) {
        map.setCenter(place.geometry.location);
        map.setZoom(17);
        placeMarker(place.geometry.location);
        
        // Auto-fill address details
        autoFillAddressFromPlace(place, 'rent');
      }
    });
    
    map.addListener('click', function(event) {
      placeMarker(event.latLng);
      
      // Reverse geocode to get address
      reverseGeocode(event.latLng, 'rent');
    });
    
    placeMarker(new google.maps.LatLng(defaultLocation));
  };

  window.initLeaseMapPicker = function() {
    const defaultLocation = { lat: 14.5995, lng: 120.9842 };
    
    leaseMap = new google.maps.Map(document.getElementById('leaseMapPicker'), {
      center: defaultLocation,
      zoom: 12,
      mapTypeControl: true,
      streetViewControl: true,
      styles: [
        {
          "featureType": "administrative",
          "elementType": "geometry",
          "stylers": [{"visibility": "off"}]
        },
        {
          "featureType": "poi",
          "stylers": [{"visibility": "off"}]
        },
        {
          "featureType": "road",
          "elementType": "labels.icon",
          "stylers": [{"visibility": "off"}]
        },
        {
          "featureType": "transit",
          "stylers": [{"visibility": "off"}]
        }
      ]
    });
    
    const input = document.getElementById('leaseLocationSearch');
    leaseAutocomplete = new google.maps.places.Autocomplete(input);
    leaseAutocomplete.bindTo('bounds', leaseMap);
    
    leaseAutocomplete.addListener('place_changed', function() {
      const place = leaseAutocomplete.getPlace();
      if (place.geometry) {
        leaseMap.setCenter(place.geometry.location);
        leaseMap.setZoom(17);
        placeLeaseMarker(place.geometry.location);
        
        // Auto-fill address details
        autoFillAddressFromPlace(place, 'lease');
      }
    });
    
    leaseMap.addListener('click', function(event) {
      placeLeaseMarker(event.latLng);
      
      // Reverse geocode to get address
      reverseGeocode(event.latLng, 'lease');
    });
    
    placeLeaseMarker(new google.maps.LatLng(defaultLocation));
  };

  // ===== ADDRESS PARSING HELPER =====
  function parseAddressComponents(components) {
    let address = '';
    let city = '';
    let province = '';
    let streetNumber = '';
    let route = '';
    let sublocality = '';
    let barangay = '';
    
    for (const component of components) {
      const types = component.types;
      
      if (types.includes('street_number')) {
        streetNumber = component.long_name;
      } else if (types.includes('route')) {
        route = component.long_name;
      } else if (types.includes('locality')) {
        city = component.long_name;
      } else if (types.includes('administrative_area_level_2')) {
        if (!city) city = component.long_name;
      } else if (types.includes('administrative_area_level_1')) {
        province = component.long_name;
      } else if (types.includes('postal_town')) {
        if (!city) city = component.long_name;
      } else if (types.includes('sublocality') || types.includes('sublocality_level_1')) {
        sublocality = component.long_name;
      } else if (types.includes('neighborhood')) {
        barangay = component.long_name;
      }
    }
    
    // Build address
    if (streetNumber && route) {
      address = `${streetNumber} ${route}`;
    } else if (route) {
      address = route;
    } else if (streetNumber) {
      address = streetNumber;
    }
    
    // Add barangay/sublocality if available
    if (barangay || sublocality) {
      address += `, ${barangay || sublocality}`;
    }
    
    return { address, city, province };
  }

  function placeMarker(location) {
    if (marker) {
      marker.setMap(null);
    }
    
    marker = new google.maps.Marker({
      position: location,
      map: map,
      draggable: true,
      animation: google.maps.Animation.DROP,
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 10,
        fillColor: "#3498db",
        fillOpacity: 1,
        strokeColor: "#ffffff",
        strokeWeight: 2
      }
    });
    
    updateRentCoordinates(location.lat(), location.lng());
    
    marker.addListener('dragend', function() {
      updateRentCoordinates(marker.getPosition().lat(), marker.getPosition().lng());
      
      // Reverse geocode when marker is dragged
      reverseGeocode(marker.getPosition(), 'rent');
    });
    
    // Reverse geocode initial marker position
    reverseGeocode(location, 'rent');
  }

  function placeLeaseMarker(location) {
    if (leaseMarker) {
      leaseMarker.setMap(null);
    }
    
    leaseMarker = new google.maps.Marker({
      position: location,
      map: leaseMap,
      draggable: true,
      animation: google.maps.Animation.DROP,
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 10,
        fillColor: "#9b59b6",
        fillOpacity: 1,
        strokeColor: "#ffffff",
        strokeWeight: 2
      }
    });
    
    updateLeaseCoordinates(location.lat(), location.lng());
    
    leaseMarker.addListener('dragend', function() {
      updateLeaseCoordinates(leaseMarker.getPosition().lat(), leaseMarker.getPosition().lng());
      
      // Reverse geocode when marker is dragged
      reverseGeocode(leaseMarker.getPosition(), 'lease');
    });
    
    // Reverse geocode initial marker position
    reverseGeocode(location, 'lease');
  }

  // ===== REVERSE GEOCODING =====
  function reverseGeocode(latlng, formType) {
    const geocoder = new google.maps.Geocoder();
    
    geocoder.geocode({ location: latlng }, function(results, status) {
      if (status === 'OK') {
        if (results[0]) {
          autoFillAddressFromGeocode(results[0], formType);
        }
      } else {
        console.log('Geocoder failed due to: ' + status);
      }
    });
  }

  // ===== AUTO-FILL ADDRESS FUNCTIONS =====
  function autoFillAddressFromPlace(place, formType) {
    const parsed = parseAddressComponents(place.address_components);
    let address = parsed.address;
    
    // Use formatted address if we couldn't parse street address
    if (!address && place.formatted_address) {
      address = place.formatted_address;
    }
    
    // Update form fields based on form type
    if (formType === 'rent') {
      if (address) document.getElementById('address').value = address;
      if (parsed.city) document.getElementById('city').value = parsed.city;
      if (parsed.province) document.getElementById('province').value = parsed.province;
      
      // Also update the search input
      if (place.formatted_address) {
        document.getElementById('locationSearch').value = place.formatted_address;
      }
    } else {
      if (address) document.getElementById('leaseAddress').value = address;
      if (parsed.city) document.getElementById('leaseCity').value = parsed.city;
      if (parsed.province) document.getElementById('leaseProvince').value = parsed.province;
      
      // Also update the search input
      if (place.formatted_address) {
        document.getElementById('leaseLocationSearch').value = place.formatted_address;
      }
    }
  }

  function autoFillAddressFromGeocode(result, formType) {
    const parsed = parseAddressComponents(result.address_components);
    let address = parsed.address;
    
    // Use formatted address if we couldn't parse street address
    if (!address && result.formatted_address) {
      address = result.formatted_address;
    }
    
    // Update form fields based on form type
    if (formType === 'rent') {
      if (address) document.getElementById('address').value = address;
      if (parsed.city) document.getElementById('city').value = parsed.city;
      if (parsed.province) document.getElementById('province').value = parsed.province;
      
      // Update search input
      if (result.formatted_address) {
        document.getElementById('locationSearch').value = result.formatted_address;
      }
    } else {
      if (address) document.getElementById('leaseAddress').value = address;
      if (parsed.city) document.getElementById('leaseCity').value = parsed.city;
      if (parsed.province) document.getElementById('leaseProvince').value = parsed.province;
      
      // Update search input
      if (result.formatted_address) {
        document.getElementById('leaseLocationSearch').value = result.formatted_address;
      }
    }
  }

  function updateRentCoordinates(lat, lng) {
    document.getElementById('latitude').value = lat;
    document.getElementById('longitude').value = lng;
    document.getElementById('latDisplay').textContent = lat.toFixed(6);
    document.getElementById('lngDisplay').textContent = lng.toFixed(6);
  }

  function updateLeaseCoordinates(lat, lng) {
    document.getElementById('leaseLatitude').value = lat;
    document.getElementById('leaseLongitude').value = lng;
    document.getElementById('leaseLatDisplay').textContent = lat.toFixed(6);
    document.getElementById('leaseLngDisplay').textContent = lng.toFixed(6);
  }

  // ===== KYC CHECK =====
  async function checkKYCStatus() {
    try {
      const userDoc = await firebase.firestore().collection('users').doc(currentUser.uid).get();
      
      if (!userDoc.exists) {
        showMessage('User profile not found', 'error');
        return;
      }
      
      const userData = userDoc.data();
      kycStatus = userData.kycStatus || 'not_submitted';
      
      const warning = document.getElementById('kycWarning');
      const badge = document.getElementById('kycBadge');
      const badgeText = document.getElementById('kycBadgeText');
      const statusText = document.getElementById('kycStatusText');
      const message = document.getElementById('kycMessage');
      
      // Update KYC badge
      badge.style.display = 'flex';
      badge.className = `kyc-badge ${kycStatus}`;
      
      switch(kycStatus) {
        case 'not_submitted':
          badgeText.textContent = 'KYC: Not Submitted';
          warning.style.display = 'block';
          statusText.textContent = 'Status: KYC Not Submitted';
          message.textContent = 'You must complete KYC verification before posting properties.';
          break;
          
        case 'pending':
          badgeText.textContent = 'KYC: Pending';
          warning.style.display = 'block';
          statusText.textContent = 'Status: KYC Pending Approval';
          message.textContent = 'Your KYC is under review. Please wait for approval.';
          break;
          
        case 'rejected':
          badgeText.textContent = 'KYC: Rejected';
          warning.style.display = 'block';
          statusText.textContent = 'Status: KYC Rejected';
          message.textContent = 'Your KYC was rejected. Please resubmit valid documents.';
          break;
          
        case 'approved':
          badgeText.textContent = 'KYC: Verified ‚úì';
          warning.style.display = 'none';
          break;
      }
      
    } catch (error) {
      console.error('KYC check error:', error);
      showMessage('Error checking verification status', 'error');
    }
  }

  // ===== RENT FORM SUBMISSION =====
  async function handleRentSubmit(event) {
    event.preventDefault();
    
    if (kycStatus !== 'approved') {
      showMessage('KYC verification required', 'error');
      return;
    }
    
    if (!validateRentForm()) return;
    
    const submitBtn = document.getElementById('submitRentBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Uploading...';
    
    const progress = document.getElementById('uploadProgress');
    const progressText = document.getElementById('progressText');
    const progressFill = document.getElementById('progressFill');
    
    progress.style.display = 'block';
    progressText.textContent = 'Preparing upload...';
    
    try {
      const formData = collectRentFormData();
      
      progressText.textContent = 'Creating rent listing...';
      progressFill.style.width = '10%';
      
      const propertyRef = await firebase.firestore().collection('properties').add({
        ...formData,
        userId: currentUser.uid,
        ownerId: currentUser.uid,
        type: 'rent',
        status: 'available',
        createdAt: new Date(),
        updatedAt: new Date(),
        imageUrls: [],
        videoUrls: []
      });
      
      const propertyId = propertyRef.id;
      
      progressText.textContent = `Uploading ${selectedImages.length} file(s)...`;
      progressFill.style.width = '30%';
      
      const mediaUrls = await uploadMediaFiles(selectedImages, currentUser.uid, propertyId, (percent) => {
        progressFill.style.width = `${percent}%`;
      });
      
      progressText.textContent = 'Finalizing rent listing...';
      progressFill.style.width = '95%';
      
      await propertyRef.update({
        imageUrls: mediaUrls.images.map(img => img.url),
        videoUrls: mediaUrls.videos.map(vid => vid.url),
        photos: mediaUrls.images.map(img => img.url),
        hasVideos: mediaUrls.videos.length > 0
      });
      
      progressFill.style.width = '100%';
      progressText.textContent = '‚úÖ Rent property posted successfully!';
      
      showMessage('‚úÖ Rent property posted successfully! Redirecting...', 'success');
      
      setTimeout(() => {
        window.location.href = 'landlord_listings.html';
      }, 2000);
      
    } catch (error) {
      console.error('Rent submission error:', error);
      showMessage(`Error: ${error.message}`, 'error');
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="bi bi-check-circle"></i> Post Property for Rent';
      progress.style.display = 'none';
    }
  }

  // ===== LEASE FORM SUBMISSION =====
  async function handleLeaseSubmit(event) {
    event.preventDefault();
    
    if (kycStatus !== 'approved') {
      showMessage('KYC verification required', 'error');
      return;
    }
    
    if (!validateLeaseForm()) return;
    
    const submitBtn = document.getElementById('submitLeaseBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Uploading...';
    
    const progress = document.getElementById('leaseUploadProgress');
    const progressText = document.getElementById('leaseProgressText');
    const progressFill = document.getElementById('leaseProgressFill');
    
    progress.style.display = 'block';
    progressText.textContent = 'Preparing upload...';
    
    try {
      const formData = collectLeaseFormData();
      
      progressText.textContent = 'Creating lease listing...';
      progressFill.style.width = '10%';
      
      const propertyRef = await firebase.firestore().collection('properties').add({
        ...formData,
        userId: currentUser.uid,
        ownerId: currentUser.uid,
        type: 'lease',
        status: 'available',
        createdAt: new Date(),
        updatedAt: new Date(),
        imageUrls: [],
        videoUrls: []
      });
      
      const propertyId = propertyRef.id;
      
      progressText.textContent = `Uploading ${selectedLeaseImages.length} file(s)...`;
      progressFill.style.width = '30%';
      
      const mediaUrls = await uploadMediaFiles(selectedLeaseImages, currentUser.uid, propertyId, (percent) => {
        progressFill.style.width = `${percent}%`;
      });
      
      progressText.textContent = 'Finalizing lease listing...';
      progressFill.style.width = '95%';
      
      await propertyRef.update({
        imageUrls: mediaUrls.images.map(img => img.url),
        videoUrls: mediaUrls.videos.map(vid => vid.url),
        photos: mediaUrls.images.map(img => img.url),
        hasVideos: mediaUrls.videos.length > 0
      });
      
      progressFill.style.width = '100%';
      progressText.textContent = '‚úÖ Lease property posted successfully!';
      
      showMessage('‚úÖ Lease property posted successfully! Redirecting...', 'success');
      
      setTimeout(() => {
        window.location.href = 'landlord_listings.html';
      }, 2000);
      
    } catch (error) {
      console.error('Lease submission error:', error);
      showMessage(`Error: ${error.message}`, 'error');
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="bi bi-check-circle"></i> Post Property for Lease';
      progress.style.display = 'none';
    }
  }

  // ===== UPLOAD MEDIA FILES =====
  async function uploadMediaFiles(files, userId, propertyId, progressCallback) {
    const mediaUrls = {
      images: [],
      videos: []
    };
    
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const timestamp = Date.now();
      const fileExt = file.name.split('.').pop();
      const fileName = `${propertyId}_${timestamp}_${i}.${fileExt}`;
      const fileType = file.type.startsWith('video/') ? 'videos' : 'images';
      
      const storageRef = firebase.storage().ref()
        .child(`properties/${userId}/${propertyId}/${fileType}/${fileName}`);
      
      const snapshot = await storageRef.put(file);
      const downloadURL = await snapshot.ref.getDownloadURL();
      
      mediaUrls[fileType].push({
        url: downloadURL,
        type: file.type,
        name: fileName,
        size: file.size
      });
      
      const progressPercent = 30 + ((i + 1) / files.length) * 60;
      if (progressCallback) progressCallback(progressPercent);
    }
    
    return mediaUrls;
  }

  // ===== FORM VALIDATION =====
  function validateRentForm() {
    const requiredFields = [
      'title', 'propertyCategory', 'propertyType', 'bedrooms', 'bathrooms',
      'floorArea', 'address', 'city', 'province', 'monthlyRent', 'minimumStay',
      'description'
    ];
    
    for (const fieldId of requiredFields) {
      const field = document.getElementById(fieldId);
      if (!field.value.trim()) {
        showMessage(`Please fill in ${field.previousElementSibling.textContent}`, 'error');
        field.focus();
        return false;
      }
    }
    
    if (!document.getElementById('latitude').value) {
      showMessage('Please select location on map', 'error');
      return false;
    }
    
    if (selectedImages.length === 0) {
      showMessage('Please upload at least 1 property image or video', 'error');
      return false;
    }
    
    return true;
  }

  function validateLeaseForm() {
    const requiredFields = [
      'leaseTitle', 'leasePropertyCategory', 'leasePropertyType', 'totalArea',
      'leaseDuration', 'annualRent',
      'leaseAddress', 'leaseCity', 'leaseProvince', 'leaseDescription'
    ];
    
    for (const fieldId of requiredFields) {
      const field = document.getElementById(fieldId);
      if (!field.value.trim()) {
        showMessage(`Please fill in ${field.previousElementSibling?.textContent || fieldId}`, 'error');
        field.focus();
        return false;
      }
    }
    
    if (!document.getElementById('leaseLatitude').value) {
      showMessage('Please select location on map', 'error');
      return false;
    }
    
    if (!selectedLeaseType) {
      showMessage('Please select a lease type', 'error');
      return false;
    }
    
    if (selectedLeaseImages.length === 0) {
      showMessage('Please upload at least 1 property image or video', 'error');
      return false;
    }
    
    return true;
  }

  // ===== FORM DATA COLLECTION =====
  function collectRentFormData() {
    const amenities = [];
    document.querySelectorAll('input[name="amenities"]:checked').forEach(checkbox => {
      amenities.push(checkbox.value);
    });
    
    const otherAmenities = document.getElementById('otherAmenities').value;
    if (otherAmenities) {
      otherAmenities.split(',').forEach(item => {
        const trimmed = item.trim();
        if (trimmed) amenities.push(trimmed);
      });
    }
    
    return {
      title: document.getElementById('title').value,
      propertyCategory: document.getElementById('propertyCategory').value,
      propertyType: document.getElementById('propertyType').value,
      bedrooms: document.getElementById('bedrooms').value,
      bathrooms: document.getElementById('bathrooms').value,
      floorArea: parseFloat(document.getElementById('floorArea').value),
      furnishing: document.getElementById('furnishing').value || null,
      address: document.getElementById('address').value,
      location: document.getElementById('address').value,
      city: document.getElementById('city').value,
      province: document.getElementById('province').value,
      latitude: parseFloat(document.getElementById('latitude').value),
      longitude: parseFloat(document.getElementById('longitude').value),
      monthlyRent: parseFloat(document.getElementById('monthlyRent').value),
      securityDeposit: document.getElementById('securityDeposit').value ? 
        parseFloat(document.getElementById('securityDeposit').value) : null,
      advanceRent: document.getElementById('advanceRent').value ? 
        parseInt(document.getElementById('advanceRent').value) : 1,
      minimumStay: parseInt(document.getElementById('minimumStay').value),
      amenities: amenities,
      description: document.getElementById('description').value,
      listingType: 'rent',
      hasMedia: selectedImages.length > 0,
      mediaCount: selectedImages.length
    };
  }

  function collectLeaseFormData() {
    const amenities = [];
    document.querySelectorAll('input[name="leaseAmenities"]:checked').forEach(checkbox => {
      amenities.push(checkbox.value);
    });
    
    const otherFeatures = document.getElementById('otherFeatures').value;
    if (otherFeatures) {
      otherFeatures.split(',').forEach(item => {
        const trimmed = item.trim();
        if (trimmed) amenities.push(trimmed);
      });
    }
    
    const utilities = document.getElementById('utilities').value;
    if (utilities) {
      utilities.split(',').forEach(item => {
        const trimmed = item.trim();
        if (trimmed) amenities.push(trimmed);
      });
    }
    
    return {
      title: document.getElementById('leaseTitle').value,
      propertyCategory: document.getElementById('leasePropertyCategory').value,
      propertyType: document.getElementById('leasePropertyType').value,
      totalArea: parseFloat(document.getElementById('totalArea').value),
      usableArea: document.getElementById('usableArea').value ? 
        parseFloat(document.getElementById('usableArea').value) : null,
      zoning: document.getElementById('zoning').value || null,
      leaseType: document.getElementById('leaseTypeInput').value,
      leaseDuration: parseInt(document.getElementById('leaseDuration').value),
      renewalOption: document.getElementById('renewalOption').value || null,
      annualRent: parseFloat(document.getElementById('annualRent').value),
      paymentTerms: document.getElementById('paymentTerms').value || null,
      securityBond: document.getElementById('securityBond').value ? 
        parseFloat(document.getElementById('securityBond').value) : null,
      advancePayment: document.getElementById('advancePayment').value ? 
        parseInt(document.getElementById('advancePayment').value) : 1,
      address: document.getElementById('leaseAddress').value,
      location: document.getElementById('leaseAddress').value,
      city: document.getElementById('leaseCity').value,
      province: document.getElementById('leaseProvince').value,
      latitude: parseFloat(document.getElementById('leaseLatitude').value),
      longitude: parseFloat(document.getElementById('leaseLongitude').value),
      frontage: document.getElementById('frontage').value ? 
        parseFloat(document.getElementById('frontage').value) : null,
      topography: document.getElementById('topography').value || null,
      accessRoad: document.getElementById('accessRoad').value || null,
      restrictions: document.getElementById('restrictions').value || null,
      maintenance: document.getElementById('maintenance').value || null,
      amenities: amenities,
      description: document.getElementById('leaseDescription').value,
      listingType: 'lease',
      hasMedia: selectedLeaseImages.length > 0,
      mediaCount: selectedLeaseImages.length
    };
  }

  // ===== UTILITY FUNCTIONS =====
  function showMessage(text, type) {
    const box = document.getElementById('messageBox');
    box.textContent = text;
    box.className = `message ${type}`;
    box.style.display = 'block';
    
    setTimeout(() => {
      box.style.display = 'none';
    }, 5000);
  }

  function resetRentForm() {
    if (confirm('Are you sure you want to reset the rent form? All entered data will be lost.')) {
      document.getElementById('rentalForm').reset();
      document.getElementById('previewContainer').innerHTML = '';
      selectedImages = [];
      updatePropertyTypes();
      
      // Reset file input
      document.getElementById('mediaFiles').value = '';
      
      // Hide image count
      document.getElementById('imageCount').style.display = 'none';
    }
  }

  function resetLeaseForm() {
    if (confirm('Are you sure you want to reset the lease form? All entered data will be lost.')) {
      document.getElementById('leasePropertyForm').reset();
      document.getElementById('leasePreviewContainer').innerHTML = '';
      selectedLeaseImages = [];
      selectedLeaseType = null;
      updateLeasePropertyTypes();
      
      // Reset file input
      document.getElementById('leaseMediaFiles').value = '';
      
      // Hide image count
      document.getElementById('leaseImageCount').style.display = 'none';
      
      document.querySelectorAll('.lease-option').forEach(option => {
        option.classList.remove('active');
      });
    }
  }
</script>
</body>
</html>