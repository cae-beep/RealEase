<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post Rental Property</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    /* ===== BASE STYLES ===== */
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    /* ===== HEADER & NAVIGATION ===== */
    header { 
      background: rgba(44, 62, 80, 0.95); 
      padding: 15px 20px; 
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 20px rgba(0,0,0,0.2);
    }
    nav { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      max-width: 1200px;
      margin: 0 auto;
    }
    .nav-left, .nav-right { 
      display: flex; 
      align-items: center; 
      gap: 20px; 
    }
    nav a { 
      color: white; 
      text-decoration: none; 
      padding: 10px 20px; 
      border-radius: 8px;
      transition: all 0.3s;
      font-weight: 500;
    }
    nav a:hover { 
      background: rgba(255,255,255,0.15); 
      transform: translateY(-2px);
    }
    .nav-left a.active {
      background: #3498db;
    }
    .hamburger { 
      display: none; 
      flex-direction: column; 
      justify-content: space-between; 
      width: 30px; 
      height: 24px; 
      background: none; 
      border: none; 
      cursor: pointer; 
      padding: 0;
    }
    .hamburger span { 
      display: block; 
      height: 3px; 
      width: 100%; 
      background: white; 
      border-radius: 2px; 
      transition: 0.3s; 
    }
    
    /* ===== MAIN CONTAINER ===== */
    .container { 
      max-width: 1000px; 
      margin: 100px auto 40px; 
      padding: 0 20px;
    }
    
    /* ===== CARD STYLES ===== */
    .card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #3498db, #2ecc71);
    }
    
    /* ===== TYPE SELECTION ===== */
    .type-selection {
      text-align: center;
      margin-bottom: 40px;
    }
    .type-selection h2 {
      color: #2c3e50;
      margin-bottom: 30px;
      font-size: 28px;
      position: relative;
      padding-bottom: 15px;
    }
    .type-selection h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background: #3498db;
      border-radius: 2px;
    }
    .type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }
    .type-card {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    .type-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      border-color: #3498db;
    }
    .type-card.active {
      border-color: #3498db;
      background: #e8f4fc;
      box-shadow: 0 5px 20px rgba(52, 152, 219, 0.2);
    }
    .type-card.lease-active {
      border-color: #9b59b6;
      background: #f3e6f8;
      box-shadow: 0 5px 20px rgba(155, 89, 182, 0.2);
    }
    .type-icon {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
    }
    .type-card h3 {
      color: #2c3e50;
      margin: 10px 0;
      font-size: 22px;
    }
    .type-card .subtitle {
      color: #7f8c8d;
      font-size: 14px;
      margin-bottom: 15px;
      font-style: italic;
    }
    .type-card .description {
      color: #555;
      font-size: 14px;
      line-height: 1.6;
    }
    
    /* ===== PROPERTY DETAILS ===== */
    .property-details {
      display: none;
    }
    .property-details.active {
      display: block;
    }
    .section-title {
      font-size: 22px;
      color: #2c3e50;
      margin: 30px 0 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-title::before {
      font-size: 20px;
    }
    
    /* ===== FORM STYLES ===== */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    .form-group {
      margin-bottom: 25px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
      font-size: 15px;
    }
    .required::after {
      content: " *";
      color: #e74c3c;
    }
    input, select, textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.3s;
      background: #fafafa;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3498db;
      background: white;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    .lease-form input:focus, .lease-form select:focus, .lease-form textarea:focus {
      border-color: #9b59b6;
      box-shadow: 0 0 0 3px rgba(155, 89, 182, 0.1);
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    /* ===== SPECIAL FIELDS ===== */
    .input-with-icon {
      position: relative;
    }
    .input-with-icon i {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #7f8c8d;
    }
    .input-with-icon input,
    .input-with-icon select {
      padding-left: 45px;
    }
    
    .dimensions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    /* ===== AMENITIES ===== */
    .amenities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }
    .amenity-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .amenity-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin: 0;
    }
    
    /* ===== IMAGE UPLOAD ===== */
    .image-upload-area {
      border: 2px dashed #bdc3c7;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      background: #f8f9fa;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 20px;
    }
    .image-upload-area:hover {
      border-color: #3498db;
      background: #e8f4fc;
    }
    .lease-form .image-upload-area:hover {
      border-color: #9b59b6;
      background: #f3e6f8;
    }
    .image-upload-area i {
      font-size: 48px;
      color: #7f8c8d;
      margin-bottom: 15px;
      display: block;
    }
    .preview-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .preview-item {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .preview-item img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      display: block;
    }
    .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(231, 76, 60, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    .remove-btn:hover {
      background: #c0392b;
      transform: scale(1.1);
    }
    
    /* ===== BUTTONS ===== */
    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 40px;
      padding-top: 25px;
      border-top: 1px solid #eee;
    }
    .btn {
      padding: 14px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
    }
    .btn-lease {
      background: linear-gradient(135deg, #9b59b6, #8e44ad);
      color: white;
    }
    .btn-lease:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(155, 89, 182, 0.4);
    }
    .btn-secondary {
      background: #95a5a6;
      color: white;
    }
    .btn-secondary:hover {
      background: #7f8c8d;
      transform: translateY(-2px);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    /* ===== MESSAGES & WARNINGS ===== */
    .message {
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      font-weight: 500;
      display: none;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .message.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .kyc-warning {
      background: linear-gradient(135deg, #ffeaa7, #fab1a0);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      text-align: center;
      border: 2px solid #fdcb6e;
    }
    .kyc-warning h2 {
      color: #d63031;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 24px;
    }
    
    /* ===== MAP ===== */
    #mapPicker, #leaseMapPicker {
      width: 100%;
      height: 400px;
      border: 2px solid #ddd;
      border-radius: 12px;
      margin-top: 10px;
    }
    .coordinates-display {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }
    .coord-box {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    .coord-box label {
      font-size: 13px;
      color: #7f8c8d;
      margin: 0 0 5px 0;
    }
    .coord-box span {
      display: block;
      font-size: 18px;
      font-weight: bold;
      color: #3498db;
    }
    .lease-form .coord-box span {
      color: #9b59b6;
    }
    
    /* ===== LEASE SPECIFIC STYLES ===== */
    .lease-term-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 10px;
    }
    .lease-option {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    .lease-option:hover {
      border-color: #9b59b6;
      background: #f3e6f8;
    }
    .lease-option.active {
      border-color: #9b59b6;
      background: #e8f4fc;
      box-shadow: 0 5px 15px rgba(155, 89, 182, 0.2);
    }
    
    /* ===== LOADING ===== */
    .upload-progress {
      background: #e3f2fd;
      border: 2px solid #2196f3;
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      display: none;
    }
    .upload-progress.active {
      display: block;
    }
    .progress-bar {
      width: 100%;
      height: 12px;
      background: #e0e0e0;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 15px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2196f3, #2ecc71);
      transition: width 0.3s;
      border-radius: 6px;
    }
    .lease-upload .progress-fill {
      background: linear-gradient(90deg, #9b59b6, #2ecc71);
    }
    
    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .container {
        margin-top: 80px;
        padding: 15px;
      }
      .card {
        padding: 25px;
      }
      .type-grid {
        grid-template-columns: 1fr;
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
      .form-actions {
        flex-direction: column;
      }
      .btn {
        width: 100%;
        justify-content: center;
      }
      .hamburger {
        display: flex;
      }
      .nav-left, .nav-right {
        display: none;
        flex-direction: column;
        width: 100%;
        gap: 0;
        background: #2c3e50;
        position: absolute;
        top: 60px;
        left: 0;
        padding: 20px;
      }
      .nav-left.active, .nav-right.active {
        display: flex;
      }
      nav a {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>

<header>
  <nav>
    <div class="nav-left">
      <a href="landlord_dashboard.html">üè† Home</a>
      <a href="my_properties.html" class="active">üìã My Properties</a>
      <div class="dropdown">
        <a href="#">üìä List Property ‚ñæ</a>
        <div style="display: none; position: absolute; background: white; min-width: 200px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); border-radius: 8px; padding: 10px 0; z-index: 100;">
          <a href="rent_property.html" style="color: #333; padding: 10px 20px; display: block;">üè† For Rent</a>
        </div>
      </div>
    </div>
    <div class="nav-right">
      <a href="../kyc.html">üõ°Ô∏è KYC Verification</a>
      <a href="#" id="logoutBtn">üö™ Logout</a>
    </div>
    <button class="hamburger" onclick="toggleMenu()">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </nav>
</header>

<div class="container">
  <!-- KYC Warning -->
  <div id="kycWarning" class="kyc-warning" style="display: none;">
    <h2>‚ö†Ô∏è KYC Verification Required</h2>
    <p id="kycStatusText"></p>
    <p id="kycMessage"></p>
    <a href="../kyc.html" style="display: inline-block; background: #e74c3c; color: white; padding: 12px 25px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-top: 15px;">
      üîí Complete KYC Verification
    </a>
  </div>

  <!-- Success/Error Messages -->
  <div id="messageBox" class="message" style="display: none;"></div>

  <!-- Type Selection -->
  <div class="card">
    <div class="type-selection">
      <h2>Choose Listing Type</h2>
      <div class="type-grid">
        <div class="type-card active" onclick="selectType('rent')">
          <span class="type-icon">üè†</span>
          <h3>FOR RENT</h3>
          <div class="subtitle">Short-term or renewable occupancy, usually monthly</div>
          <div class="description">
            Perfect for residential or commercial spaces available for monthly rental.
          </div>
        </div>
        <div class="type-card" onclick="selectType('lease')">
          <span class="type-icon">üìú</span>
          <h3>FOR LEASE</h3>
          <div class="subtitle">Long-term contractual use, usually 1‚Äì10 years</div>
          <div class="description">
            Ideal for commercial spaces, land, or special purpose properties for long-term lease.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RENT Form -->
  <div id="rentForm" class="card property-details active">
    <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 30px; border-bottom: 3px solid #3498db; padding-bottom: 15px;">
      üè† Post Property For Rent
    </h2>
    
    <form id="rentalForm">
      <!-- Basic Information -->
      <h3 class="section-title">üìã Basic Information</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="title" class="required">Property Title</label>
          <input type="text" id="title" placeholder="e.g., Modern 2-Bedroom Apartment in BGC" required>
        </div>
        
        <div class="form-group">
          <label for="propertyCategory" class="required">Property Category</label>
          <select id="propertyCategory" required onchange="updatePropertyTypes()">
            <option value="">-- Select Category --</option>
            <option value="residential">Residential Property</option>
            <option value="commercial">Commercial Property</option>
            <option value="industrial">Industrial / Storage</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="propertyType" class="required">Property Type</label>
          <select id="propertyType" required>
            <option value="">-- Select Type --</option>
            <!-- Options populated by JavaScript -->
          </select>
        </div>
      </div>

      <!-- Property Specifications -->
      <h3 class="section-title">üìê Property Specifications</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="bedrooms" class="required">Bedrooms</label>
          <select id="bedrooms" required>
            <option value="">-- Select --</option>
            <option value="studio">Studio</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5+</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="bathrooms" class="required">Bathrooms</label>
          <select id="bathrooms" required>
            <option value="">-- Select --</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4+</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="floorArea" class="required">Floor Area (sqm)</label>
          <div class="input-with-icon">
            <i>üìè</i>
            <input type="number" id="floorArea" placeholder="e.g., 75" min="1" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="furnishing">Furnishing</label>
          <select id="furnishing">
            <option value="">-- Select --</option>
            <option value="furnished">Fully Furnished</option>
            <option value="semi-furnished">Semi-Furnished</option>
            <option value="unfurnished">Unfurnished</option>
          </select>
        </div>
      </div>

      <!-- Location -->
      <h3 class="section-title">üìç Location Details</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="address" class="required">Full Address</label>
          <input type="text" id="address" placeholder="Complete address" required>
        </div>
        
        <div class="form-group">
          <label for="city" class="required">City/Municipality</label>
          <input type="text" id="city" placeholder="e.g., Makati City" required>
        </div>
        
        <div class="form-group">
          <label for="province" class="required">Province</label>
          <input type="text" id="province" placeholder="e.g., Metro Manila" required>
        </div>
      </div>
      
      <div class="form-group">
        <label>üìç Pin Location on Map</label>
        <input type="text" id="locationSearch" placeholder="Search address or click on map..." style="margin-bottom: 10px;">
        <div id="mapPicker"></div>
        <div class="coordinates-display">
          <div class="coord-box">
            <label>Latitude</label>
            <span id="latDisplay">Not set</span>
          </div>
          <div class="coord-box">
            <label>Longitude</label>
            <span id="lngDisplay">Not set</span>
          </div>
        </div>
        <input type="hidden" id="latitude" name="latitude">
        <input type="hidden" id="longitude" name="longitude">
      </div>

      <!-- Pricing -->
      <h3 class="section-title">üí∞ Pricing Information</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="monthlyRent" class="required">Monthly Rent (‚Ç±)</label>
          <div class="input-with-icon">
            <i>üí∞</i>
            <input type="number" id="monthlyRent" placeholder="e.g., 25000" min="1000" step="100" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="securityDeposit">Security Deposit (‚Ç±)</label>
          <div class="input-with-icon">
            <i>üè¶</i>
            <input type="number" id="securityDeposit" placeholder="e.g., 25000" min="0" step="100">
          </div>
        </div>
        
        <div class="form-group">
          <label for="advanceRent">Advance Rent (months)</label>
          <div class="input-with-icon">
            <i>üìÖ</i>
            <input type="number" id="advanceRent" placeholder="e.g., 2" min="1" value="1">
          </div>
        </div>
        
        <div class="form-group">
          <label for="minimumStay" class="required">Minimum Stay (months)</label>
          <div class="input-with-icon">
            <i>‚è±Ô∏è</i>
            <input type="number" id="minimumStay" placeholder="e.g., 6" min="1" required value="6">
          </div>
        </div>
      </div>

      <!-- Amenities -->
      <h3 class="section-title">üèä Amenities & Features</h3>
      <div class="amenities-grid">
        <div class="amenity-item">
          <input type="checkbox" id="wifi" name="amenities" value="WiFi">
          <label for="wifi">WiFi</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="ac" name="amenities" value="Air Conditioning">
          <label for="ac">Air Conditioning</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="parking" name="amenities" value="Parking">
          <label for="parking">Parking</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="furniture" name="amenities" value="Furniture">
          <label for="furniture">Furniture</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="kitchen" name="amenities" value="Kitchen">
          <label for="kitchen">Kitchen</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="laundry" name="amenities" value="Laundry">
          <label for="laundry">Laundry</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="security" name="amenities" value="24/7 Security">
          <label for="security">24/7 Security</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="elevator" name="amenities" value="Elevator">
          <label for="elevator">Elevator</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="pool" name="amenities" value="Swimming Pool">
          <label for="pool">Swimming Pool</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="gym" name="amenities" value="Gym">
          <label for="gym">Gym</label>
        </div>
      </div>
      <div class="form-group" style="margin-top: 15px;">
        <label for="otherAmenities">Other Amenities (comma-separated)</label>
        <input type="text" id="otherAmenities" placeholder="e.g., Garden, CCTV, Generator">
      </div>

      <!-- Description -->
      <div class="form-group">
        <label for="description" class="required">Property Description</label>
        <textarea id="description" placeholder="Describe your property in detail..." rows="6" required></textarea>
      </div>

      <!-- Images -->
      <h3 class="section-title">üì∏ Property Images</h3>
      <div class="image-upload-area" onclick="document.getElementById('images').click()">
        <i>üìÅ</i>
        <p style="font-size: 18px; font-weight: 600; color: #2c3e50; margin: 10px 0;">Upload Property Images</p>
        <p style="color: #7f8c8d; margin: 5px 0;">Drag & drop or click to browse</p>
        <p style="font-size: 14px; color: #95a5a6;">Max 10 images ‚Ä¢ 5MB per image ‚Ä¢ JPG, PNG</p>
      </div>
      <input type="file" id="images" accept="image/*" multiple style="display: none;" onchange="previewImages(event)">
      <div class="preview-container" id="previewContainer"></div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetRentForm()">
          üîÑ Reset Form
        </button>
        <button type="submit" class="btn btn-primary" id="submitRentBtn">
          üöÄ Post Property for Rent
        </button>
      </div>
    </form>
  </div>

  <!-- LEASE Form (initially hidden) -->
  <div id="leaseForm" class="card property-details lease-form" style="display: none;">
    <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 30px; border-bottom: 3px solid #9b59b6; padding-bottom: 15px;">
      üìú Post Property For Lease
    </h2>
    
    <form id="leasePropertyForm">
      <!-- Property Category Selection -->
      <h3 class="section-title">üè¢ Property Category</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="leasePropertyCategory" class="required">Select Category</label>
          <select id="leasePropertyCategory" required onchange="updateLeasePropertyTypes()">
            <option value="">-- Select Category --</option>
            <option value="commercial">Commercial Property</option>
            <option value="land">Land / Lot</option>
            <option value="special">Special Purpose Property</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="leasePropertyType" class="required">Property Type</label>
          <select id="leasePropertyType" required>
            <option value="">-- Select Type --</option>
            <!-- Options populated by JavaScript -->
          </select>
        </div>
      </div>

      <!-- Basic Information -->
      <h3 class="section-title">üìã Basic Information</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="leaseTitle" class="required">Property Title</label>
          <input type="text" id="leaseTitle" placeholder="e.g., Commercial Office Floor in Makati CBD" required>
        </div>
        
        <div class="form-group">
          <label for="totalArea" class="required">Total Area (sqm)</label>
          <div class="input-with-icon">
            <i>üìè</i>
            <input type="number" id="totalArea" placeholder="e.g., 500" min="1" required step="0.01">
          </div>
        </div>
        
        <div class="form-group">
          <label for="usableArea">Usable Area (sqm)</label>
          <div class="input-with-icon">
            <i>üìê</i>
            <input type="number" id="usableArea" placeholder="Optional" min="1" step="0.01">
          </div>
        </div>
        
        <div class="form-group">
          <label for="zoning">Zoning Classification</label>
          <select id="zoning">
            <option value="">-- Select Zoning --</option>
            <option value="commercial">Commercial</option>
            <option value="industrial">Industrial</option>
            <option value="residential">Residential</option>
            <option value="agricultural">Agricultural</option>
            <option value="mixed_use">Mixed Use</option>
            <option value="tourism">Tourism</option>
          </select>
        </div>
      </div>

      <!-- Lease Terms -->
      <h3 class="section-title">üìÖ Lease Terms</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="leaseType" class="required">Lease Type</label>
          <div class="lease-term-grid">
            <div class="lease-option" onclick="selectLeaseType('gross')">
              <h4>Gross Lease</h4>
              <p style="font-size: 13px; color: #7f8c8d;">Rent includes all operating expenses</p>
            </div>
            <div class="lease-option" onclick="selectLeaseType('net')">
              <h4>Net Lease</h4>
              <p style="font-size: 13px; color: #7f8c8d;">Tenant pays rent + some expenses</p>
            </div>
            <div class="lease-option" onclick="selectLeaseType('triple-net')">
              <h4>Triple Net (NNN)</h4>
              <p style="font-size: 13px; color: #7f8c8d;">Tenant pays all expenses</p>
            </div>
          </div>
          <input type="hidden" id="leaseTypeInput" name="leaseType" required>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="leaseDuration" class="required">Lease Duration</label>
            <select id="leaseDuration" required>
              <option value="">-- Select Duration --</option>
              <option value="1">1 Year</option>
              <option value="2">2 Years</option>
              <option value="3">3 Years</option>
              <option value="5">5 Years</option>
              <option value="10">10 Years</option>
              <option value="15">15+ Years</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="renewalOption">Renewal Option</label>
            <select id="renewalOption">
              <option value="">-- Select Option --</option>
              <option value="automatic">Automatic Renewal</option>
              <option value="negotiable">Negotiable</option>
              <option value="none">No Renewal Option</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Pricing -->
      <h3 class="section-title">üí∞ Pricing Information</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="annualRent" class="required">Annual Rent (‚Ç±)</label>
          <div class="input-with-icon">
            <i>üí∞</i>
            <input type="number" id="annualRent" placeholder="e.g., 1200000" min="10000" step="1000" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="paymentTerms">Payment Terms</label>
          <select id="paymentTerms">
            <option value="">-- Select Terms --</option>
            <option value="monthly">Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="semi-annual">Semi-Annual</option>
            <option value="annual">Annual</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="securityBond">Security Bond (‚Ç±)</label>
          <div class="input-with-icon">
            <i>üè¶</i>
            <input type="number" id="securityBond" placeholder="e.g., 300000" min="0" step="1000">
          </div>
        </div>
        
        <div class="form-group">
          <label for="advancePayment">Advance Payment (months)</label>
          <div class="input-with-icon">
            <i>üìÖ</i>
            <input type="number" id="advancePayment" placeholder="e.g., 3" min="1" value="1">
          </div>
        </div>
      </div>

      <!-- Location Details -->
      <h3 class="section-title">üìç Location Details</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="leaseAddress" class="required">Full Address</label>
          <input type="text" id="leaseAddress" placeholder="Complete address including street, barangay, city" required>
        </div>
        
        <div class="form-group">
          <label for="leaseCity" class="required">City/Municipality</label>
          <input type="text" id="leaseCity" placeholder="e.g., Makati City" required>
        </div>
        
        <div class="form-group">
          <label for="leaseProvince" class="required">Province</label>
          <input type="text" id="leaseProvince" placeholder="e.g., Metro Manila" required>
        </div>
      </div>
      
      <!-- Map -->
      <div class="form-group">
        <label>üìç Pin Location on Map</label>
        <input type="text" id="leaseLocationSearch" placeholder="Search address or click on map..." style="margin-bottom: 10px;">
        <div id="leaseMapPicker"></div>
        <div class="coordinates-display">
          <div class="coord-box">
            <label>Latitude</label>
            <span id="leaseLatDisplay">Not set</span>
          </div>
          <div class="coord-box">
            <label>Longitude</label>
            <span id="leaseLngDisplay">Not set</span>
          </div>
        </div>
        <input type="hidden" id="leaseLatitude" name="leaseLatitude">
        <input type="hidden" id="leaseLongitude" name="leaseLongitude">
      </div>

      <!-- Property Features -->
      <h3 class="section-title">üèóÔ∏è Property Features</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="accessRoad">Access Road Type</label>
          <select id="accessRoad">
            <option value="">-- Select --</option>
            <option value="concrete">Concrete</option>
            <option value="asphalt">Asphalt</option>
            <option value="gravel">Gravel</option>
            <option value="dirt">Dirt Road</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="frontage">Frontage (meters)</label>
          <div class="input-with-icon">
            <i>üìê</i>
            <input type="number" id="frontage" placeholder="e.g., 20" min="1" step="0.1">
          </div>
        </div>
        
        <div class="form-group">
          <label for="topography">Topography</label>
          <select id="topography">
            <option value="">-- Select --</option>
            <option value="flat">Flat</option>
            <option value="sloping">Sloping</option>
            <option value="hilly">Hilly</option>
            <option value="mountainous">Mountainous</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="utilities">Available Utilities</label>
          <input type="text" id="utilities" placeholder="e.g., Electricity, Water, Internet">
        </div>
      </div>

      <!-- Amenities & Infrastructure -->
      <h3 class="section-title">‚ö° Amenities & Infrastructure</h3>
      <div class="amenities-grid">
        <div class="amenity-item">
          <input type="checkbox" id="parking_lease" name="leaseAmenities" value="Parking Area">
          <label for="parking_lease">Parking Area</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="loading_dock" name="leaseAmenities" value="Loading Dock">
          <label for="loading_dock">Loading Dock</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="security_system" name="leaseAmenities" value="Security System">
          <label for="security_system">Security System</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="fire_safety" name="leaseAmenities" value="Fire Safety System">
          <label for="fire_safety">Fire Safety System</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="backup_power" name="leaseAmenities" value="Backup Power">
          <label for="backup_power">Backup Power</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="cctv" name="leaseAmenities" value="CCTV">
          <label for="cctv">CCTV Surveillance</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="warehouse" name="leaseAmenities" value="Warehouse Space">
          <label for="warehouse">Warehouse Space</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="office_space" name="leaseAmenities" value="Office Space">
          <label for="office_space">Office Space</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="landscaping" name="leaseAmenities" value="Landscaping">
          <label for="landscaping">Landscaping</label>
        </div>
        <div class="amenity-item">
          <input type="checkbox" id="drainage" name="leaseAmenities" value="Drainage System">
          <label for="drainage">Drainage System</label>
        </div>
      </div>
      
      <div class="form-group" style="margin-top: 15px;">
        <label for="otherFeatures">Other Features (comma-separated)</label>
        <input type="text" id="otherFeatures" placeholder="e.g., High ceilings, Sprinkler system, Truck access">
      </div>

      <!-- Restrictions & Conditions -->
      <h3 class="section-title">‚öñÔ∏è Restrictions & Conditions</h3>
      <div class="form-group">
        <label for="restrictions">Use Restrictions</label>
        <textarea id="restrictions" placeholder="Describe any use restrictions, zoning limitations, or special conditions..." rows="4"></textarea>
      </div>
      
      <div class="form-group">
        <label for="maintenance">Maintenance Responsibility</label>
        <select id="maintenance">
          <option value="">-- Select Responsibility --</option>
          <option value="landlord">Landlord</option>
          <option value="tenant">Tenant</option>
          <option value="shared">Shared</option>
        </select>
      </div>

      <!-- Property Description -->
      <div class="form-group">
        <label for="leaseDescription" class="required">Property Description</label>
        <textarea id="leaseDescription" placeholder="Describe the property in detail, including development potential, nearby landmarks, transportation access, etc." rows="6" required></textarea>
      </div>

      <!-- Images -->
      <h3 class="section-title">üì∏ Property Images</h3>
      <div class="image-upload-area" onclick="document.getElementById('leaseImages').click()">
        <i>üìÅ</i>
        <p style="font-size: 18px; font-weight: 600; color: #2c3e50; margin: 10px 0;">Upload Property Images</p>
        <p style="color: #7f8c8d; margin: 5px 0;">Drag & drop or click to browse</p>
        <p style="font-size: 14px; color: #95a5a6;">Max 10 images ‚Ä¢ 5MB per image ‚Ä¢ JPG, PNG</p>
      </div>
      <input type="file" id="leaseImages" accept="image/*" multiple style="display: none;" onchange="previewLeaseImages(event)">
      <div class="preview-container" id="leasePreviewContainer"></div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetLeaseForm()">
          üîÑ Reset Form
        </button>
        <button type="submit" class="btn btn-lease" id="submitLeaseBtn">
          üìú Post Property for Lease
        </button>
      </div>
    </form>
  </div>

  <!-- Upload Progress for Rent -->
  <div id="uploadProgress" class="upload-progress">
    <h3 style="margin-top: 0; color: #2c3e50;">üì§ Uploading Property...</h3>
    <p id="progressText">Preparing upload...</p>
    <div class="progress-bar">
      <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
    </div>
  </div>

  <!-- Upload Progress for Lease -->
  <div id="leaseUploadProgress" class="upload-progress lease-upload" style="display: none;">
    <h3 style="margin-top: 0; color: #2c3e50;">üì§ Uploading Lease Property...</h3>
    <p id="leaseProgressText">Preparing upload...</p>
    <div class="progress-bar">
      <div id="leaseProgressFill" class="progress-fill" style="width: 0%;"></div>
    </div>
  </div>
</div>

<!-- Firebase & Maps Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwwAkIEixeUysaGrMb9BtTsMwz_C9Noxk&libraries=places" async defer></script>

<script>
  // ===== CONFIGURATION =====
  const firebaseConfig = {
    apiKey: "AIzaSyCIfzneDzWVveG8p_0mywoA9D9F5AyzZX4",
    authDomain: "bahai-1b76d.firebaseapp.com",
    projectId: "bahai-1b76d",
    storageBucket: "bahai-1b76d.firebasestorage.app",
    messagingSenderId: "646878644941",
    appId: "1:646878644941:web:5b4ccc3412250337587784"
  };

  // ===== PROPERTY TYPE MAPPING =====
  const propertyTypes = {
    residential: [
      { value: "apartment", label: "Apartment Unit" },
      { value: "boarding_house", label: "Boarding House" },
      { value: "condo", label: "Condominium Unit" },
      { value: "room", label: "Room / Bedspace" },
      { value: "townhouse", label: "Townhouse" },
      { value: "house", label: "House" },
      { value: "dormitory", label: "Dormitory" }
    ],
    commercial: [
      { value: "office_unit", label: "Office Unit" },
      { value: "retail_space", label: "Retail Space" },
      { value: "food_stall", label: "Food Stall / Kiosk" },
      { value: "shop", label: "Shop" },
      { value: "showroom", label: "Showroom" }
    ],
    industrial: [
      { value: "warehouse", label: "Warehouse" },
      { value: "storage_unit", label: "Storage Unit" },
      { value: "factory", label: "Factory" },
      { value: "workshop", label: "Workshop" }
    ]
  };

  // ===== LEASE PROPERTY TYPE MAPPING =====
  const leasePropertyTypes = {
    commercial: [
      { value: "office_floor", label: "Office Floor" },
      { value: "retail_space_lease", label: "Retail Space" },
      { value: "building_lease", label: "Building Lease" },
      { value: "commercial_unit", label: "Commercial Unit" },
      { value: "showroom_lease", label: "Showroom" },
      { value: "warehouse_lease", label: "Warehouse" }
    ],
    land: [
      { value: "commercial_lot", label: "Commercial Lot" },
      { value: "agricultural_land", label: "Agricultural Land" },
      { value: "development_land", label: "Development Land" },
      { value: "industrial_lot", label: "Industrial Lot" },
      { value: "residential_lot", label: "Residential Lot" },
      { value: "vacant_lot", label: "Vacant Lot" }
    ],
    special: [
      { value: "resort_property", label: "Resort Property" },
      { value: "event_venue", label: "Event Venue" },
      { value: "parking_area", label: "Parking Area" },
      { value: "school_property", label: "School Property" },
      { value: "hospitality", label: "Hospitality Property" },
      { value: "sports_facility", label: "Sports Facility" }
    ]
  };

  // ===== GLOBAL VARIABLES =====
  let currentUser = null;
  let kycStatus = null;
  let map, marker, autocomplete;
  let leaseMap, leaseMarker, leaseAutocomplete;
  let selectedImages = [];
  let selectedLeaseImages = [];
  let selectedLeaseType = null;

  // ===== INITIALIZE =====
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    
    // Check authentication
    firebase.auth().onAuthStateChanged(async function(user) {
      if (!user) {
        window.location.href = "../login.html";
        return;
      }
      currentUser = user;
      await checkKYCStatus();
    });
    
    // Initialize forms
    initializeRentForm();
    initializeLeaseForm();
    
    // Setup logout button
    document.getElementById('logoutBtn').addEventListener('click', function() {
      firebase.auth().signOut().then(() => {
        window.location.href = "../login.html";
      });
    });
  });

  // ===== TYPE SELECTION =====
  function selectType(type) {
    // Update UI
    document.querySelectorAll('.type-card').forEach(card => {
      card.classList.remove('active');
      card.classList.remove('lease-active');
    });
    
    const clickedCard = event.currentTarget;
    if (type === 'rent') {
      clickedCard.classList.add('active');
    } else {
      clickedCard.classList.add('lease-active');
    }
    
    // Show appropriate form
    if (type === 'rent') {
      document.getElementById('rentForm').style.display = 'block';
      document.getElementById('leaseForm').style.display = 'none';
    } else {
      document.getElementById('rentForm').style.display = 'none';
      document.getElementById('leaseForm').style.display = 'block';
      
      // Initialize lease map if not already done
      if (window.google && window.google.maps && !leaseMap) {
        initLeaseMapPicker();
      }
    }
  }

  // ===== RENT FORM FUNCTIONS =====
  function initializeRentForm() {
    // Update property types when category changes
    document.getElementById('propertyCategory').addEventListener('change', updatePropertyTypes);
    
    // Initialize map when Google Maps loads
    window.addEventListener('load', function() {
      if (window.google && window.google.maps && !map) {
        initMapPicker();
      }
    });
    
    // Form submission
    document.getElementById('rentalForm').addEventListener('submit', handleRentSubmit);
  }

  function updatePropertyTypes() {
    const category = document.getElementById('propertyCategory').value;
    const typeSelect = document.getElementById('propertyType');
    
    // Clear existing options
    typeSelect.innerHTML = '<option value="">-- Select Type --</option>';
    
    // Add new options based on category
    if (category && propertyTypes[category]) {
      propertyTypes[category].forEach(type => {
        const option = document.createElement('option');
        option.value = type.value;
        option.textContent = type.label;
        typeSelect.appendChild(option);
      });
    }
  }

  // ===== LEASE FORM FUNCTIONS =====
  function initializeLeaseForm() {
    // Update property types when category changes
    document.getElementById('leasePropertyCategory').addEventListener('change', updateLeasePropertyTypes);
    
    // Initialize lease type selection
    document.querySelectorAll('.lease-option').forEach(option => {
      option.addEventListener('click', function() {
        selectLeaseType(this.querySelector('h4').textContent.toLowerCase());
      });
    });
    
    // Form submission
    document.getElementById('leasePropertyForm').addEventListener('submit', handleLeaseSubmit);
  }

  function updateLeasePropertyTypes() {
    const category = document.getElementById('leasePropertyCategory').value;
    const typeSelect = document.getElementById('leasePropertyType');
    
    // Clear existing options
    typeSelect.innerHTML = '<option value="">-- Select Type --</option>';
    
    // Add new options based on category
    if (category && leasePropertyTypes[category]) {
      leasePropertyTypes[category].forEach(type => {
        const option = document.createElement('option');
        option.value = type.value;
        option.textContent = type.label;
        typeSelect.appendChild(option);
      });
    }
  }

  function selectLeaseType(type) {
    selectedLeaseType = type;
    document.getElementById('leaseTypeInput').value = type;
    
    // Update UI
    document.querySelectorAll('.lease-option').forEach(option => {
      option.classList.remove('active');
    });
    
    event.currentTarget.classList.add('active');
  }

  // ===== IMAGE HANDLING =====
  function previewImages(event) {
    const files = event.target.files;
    const container = document.getElementById('previewContainer');
    
    container.innerHTML = '';
    selectedImages = Array.from(files).slice(0, 10);
    
    if (selectedImages.length === 0) return;
    
    selectedImages.forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const div = document.createElement('div');
        div.className = 'preview-item';
        div.innerHTML = `
          <img src="${e.target.result}" alt="Preview ${index + 1}">
          <button type="button" class="remove-btn" onclick="removeImage(${index})">√ó</button>
        `;
        container.appendChild(div);
      };
      reader.readAsDataURL(file);
    });
  }

  function previewLeaseImages(event) {
    const files = event.target.files;
    const container = document.getElementById('leasePreviewContainer');
    
    container.innerHTML = '';
    selectedLeaseImages = Array.from(files).slice(0, 10);
    
    if (selectedLeaseImages.length === 0) return;
    
    selectedLeaseImages.forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const div = document.createElement('div');
        div.className = 'preview-item';
        div.innerHTML = `
          <img src="${e.target.result}" alt="Preview ${index + 1}">
          <button type="button" class="remove-btn" onclick="removeLeaseImage(${index})">√ó</button>
        `;
        container.appendChild(div);
      };
      reader.readAsDataURL(file);
    });
  }

  function removeImage(index) {
    selectedImages.splice(index, 1);
    previewImages({ target: { files: selectedImages } });
  }

  function removeLeaseImage(index) {
    selectedLeaseImages.splice(index, 1);
    previewLeaseImages({ target: { files: selectedLeaseImages } });
  }

  // ===== MAP FUNCTIONS =====
  window.initMapPicker = function() {
    const defaultLocation = { lat: 14.5995, lng: 120.9842 };
    
    map = new google.maps.Map(document.getElementById('mapPicker'), {
      center: defaultLocation,
      zoom: 12,
      mapTypeControl: true,
      streetViewControl: true
    });
    
    const input = document.getElementById('locationSearch');
    autocomplete = new google.maps.places.Autocomplete(input);
    autocomplete.bindTo('bounds', map);
    
    autocomplete.addListener('place_changed', function() {
      const place = autocomplete.getPlace();
      if (place.geometry) {
        map.setCenter(place.geometry.location);
        map.setZoom(17);
        placeMarker(place.geometry.location);
        
        // Auto-fill address details
        autoFillAddressFromPlace(place, 'rent');
      }
    });
    
    map.addListener('click', function(event) {
      placeMarker(event.latLng);
      
      // Reverse geocode to get address
      reverseGeocode(event.latLng, 'rent');
    });
    
    placeMarker(new google.maps.LatLng(defaultLocation));
  };

  window.initLeaseMapPicker = function() {
    const defaultLocation = { lat: 14.5995, lng: 120.9842 };
    
    leaseMap = new google.maps.Map(document.getElementById('leaseMapPicker'), {
      center: defaultLocation,
      zoom: 12,
      mapTypeControl: true,
      streetViewControl: true
    });
    
    const input = document.getElementById('leaseLocationSearch');
    leaseAutocomplete = new google.maps.places.Autocomplete(input);
    leaseAutocomplete.bindTo('bounds', leaseMap);
    
    leaseAutocomplete.addListener('place_changed', function() {
      const place = leaseAutocomplete.getPlace();
      if (place.geometry) {
        leaseMap.setCenter(place.geometry.location);
        leaseMap.setZoom(17);
        placeLeaseMarker(place.geometry.location);
        
        // Auto-fill address details
        autoFillAddressFromPlace(place, 'lease');
      }
    });
    
    leaseMap.addListener('click', function(event) {
      placeLeaseMarker(event.latLng);
      
      // Reverse geocode to get address
      reverseGeocode(event.latLng, 'lease');
    });
    
    placeLeaseMarker(new google.maps.LatLng(defaultLocation));
  };

  // ===== ADDRESS PARSING HELPER =====
  function parseAddressComponents(components) {
    let address = '';
    let city = '';
    let province = '';
    let streetNumber = '';
    let route = '';
    let sublocality = '';
    let barangay = '';
    
    for (const component of components) {
      const types = component.types;
      
      if (types.includes('street_number')) {
        streetNumber = component.long_name;
      } else if (types.includes('route')) {
        route = component.long_name;
      } else if (types.includes('locality')) {
        city = component.long_name;
      } else if (types.includes('administrative_area_level_2')) {
        if (!city) city = component.long_name;
      } else if (types.includes('administrative_area_level_1')) {
        province = component.long_name;
      } else if (types.includes('postal_town')) {
        if (!city) city = component.long_name;
      } else if (types.includes('sublocality') || types.includes('sublocality_level_1')) {
        sublocality = component.long_name;
      } else if (types.includes('neighborhood')) {
        barangay = component.long_name;
      }
    }
    
    // Build address
    if (streetNumber && route) {
      address = `${streetNumber} ${route}`;
    } else if (route) {
      address = route;
    } else if (streetNumber) {
      address = streetNumber;
    }
    
    // Add barangay/sublocality if available
    if (barangay || sublocality) {
      address += `, ${barangay || sublocality}`;
    }
    
    return { address, city, province };
  }

  function placeMarker(location) {
    if (marker) {
      marker.setMap(null);
    }
    
    marker = new google.maps.Marker({
      position: location,
      map: map,
      draggable: true,
      animation: google.maps.Animation.DROP
    });
    
    updateRentCoordinates(location.lat(), location.lng());
    
    marker.addListener('dragend', function() {
      updateRentCoordinates(marker.getPosition().lat(), marker.getPosition().lng());
      
      // Reverse geocode when marker is dragged
      reverseGeocode(marker.getPosition(), 'rent');
    });
    
    // Reverse geocode initial marker position
    reverseGeocode(location, 'rent');
  }

  function placeLeaseMarker(location) {
    if (leaseMarker) {
      leaseMarker.setMap(null);
    }
    
    leaseMarker = new google.maps.Marker({
      position: location,
      map: leaseMap,
      draggable: true,
      animation: google.maps.Animation.DROP
    });
    
    updateLeaseCoordinates(location.lat(), location.lng());
    
    leaseMarker.addListener('dragend', function() {
      updateLeaseCoordinates(leaseMarker.getPosition().lat(), leaseMarker.getPosition().lng());
      
      // Reverse geocode when marker is dragged
      reverseGeocode(leaseMarker.getPosition(), 'lease');
    });
    
    // Reverse geocode initial marker position
    reverseGeocode(location, 'lease');
  }

  // ===== REVERSE GEOCODING =====
  function reverseGeocode(latlng, formType) {
    const geocoder = new google.maps.Geocoder();
    
    geocoder.geocode({ location: latlng }, function(results, status) {
      if (status === 'OK') {
        if (results[0]) {
          autoFillAddressFromGeocode(results[0], formType);
        }
      } else {
        console.log('Geocoder failed due to: ' + status);
      }
    });
  }

  // ===== AUTO-FILL ADDRESS FUNCTIONS =====
  function autoFillAddressFromPlace(place, formType) {
    const parsed = parseAddressComponents(place.address_components);
    let address = parsed.address;
    
    // Use formatted address if we couldn't parse street address
    if (!address && place.formatted_address) {
      address = place.formatted_address;
    }
    
    // Update form fields based on form type
    if (formType === 'rent') {
      if (address) document.getElementById('address').value = address;
      if (parsed.city) document.getElementById('city').value = parsed.city;
      if (parsed.province) document.getElementById('province').value = parsed.province;
      
      // Also update the search input
      if (place.formatted_address) {
        document.getElementById('locationSearch').value = place.formatted_address;
      }
    } else {
      if (address) document.getElementById('leaseAddress').value = address;
      if (parsed.city) document.getElementById('leaseCity').value = parsed.city;
      if (parsed.province) document.getElementById('leaseProvince').value = parsed.province;
      
      // Also update the search input
      if (place.formatted_address) {
        document.getElementById('leaseLocationSearch').value = place.formatted_address;
      }
    }
  }

  function autoFillAddressFromGeocode(result, formType) {
    const parsed = parseAddressComponents(result.address_components);
    let address = parsed.address;
    
    // Use formatted address if we couldn't parse street address
    if (!address && result.formatted_address) {
      address = result.formatted_address;
    }
    
    // Update form fields based on form type
    if (formType === 'rent') {
      if (address) document.getElementById('address').value = address;
      if (parsed.city) document.getElementById('city').value = parsed.city;
      if (parsed.province) document.getElementById('province').value = parsed.province;
      
      // Update search input
      if (result.formatted_address) {
        document.getElementById('locationSearch').value = result.formatted_address;
      }
    } else {
      if (address) document.getElementById('leaseAddress').value = address;
      if (parsed.city) document.getElementById('leaseCity').value = parsed.city;
      if (parsed.province) document.getElementById('leaseProvince').value = parsed.province;
      
      // Update search input
      if (result.formatted_address) {
        document.getElementById('leaseLocationSearch').value = result.formatted_address;
      }
    }
  }

  function updateRentCoordinates(lat, lng) {
    document.getElementById('latitude').value = lat;
    document.getElementById('longitude').value = lng;
    document.getElementById('latDisplay').textContent = lat.toFixed(6);
    document.getElementById('lngDisplay').textContent = lng.toFixed(6);
  }

  function updateLeaseCoordinates(lat, lng) {
    document.getElementById('leaseLatitude').value = lat;
    document.getElementById('leaseLongitude').value = lng;
    document.getElementById('leaseLatDisplay').textContent = lat.toFixed(6);
    document.getElementById('leaseLngDisplay').textContent = lng.toFixed(6);
  }

  // ===== KYC CHECK =====
  async function checkKYCStatus() {
    try {
      const userDoc = await firebase.firestore().collection('users').doc(currentUser.uid).get();
      
      if (!userDoc.exists) {
        showMessage('User profile not found', 'error');
        return;
      }
      
      const userData = userDoc.data();
      kycStatus = userData.kycStatus || 'not_submitted';
      
      const warning = document.getElementById('kycWarning');
      const statusText = document.getElementById('kycStatusText');
      const message = document.getElementById('kycMessage');
      
      switch(kycStatus) {
        case 'not_submitted':
          warning.style.display = 'block';
          statusText.textContent = 'Status: KYC Not Submitted';
          message.textContent = 'You must complete KYC verification before posting properties.';
          break;
          
        case 'pending':
          warning.style.display = 'block';
          statusText.textContent = 'Status: KYC Pending Approval';
          message.textContent = 'Your KYC is under review. Please wait for approval.';
          break;
          
        case 'rejected':
          warning.style.display = 'block';
          statusText.textContent = 'Status: KYC Rejected';
          message.textContent = 'Your KYC was rejected. Please resubmit valid documents.';
          break;
          
        case 'approved':
          warning.style.display = 'none';
          break;
      }
      
    } catch (error) {
      console.error('KYC check error:', error);
      showMessage('Error checking verification status', 'error');
    }
  }

  // ===== RENT FORM SUBMISSION =====
  async function handleRentSubmit(event) {
    event.preventDefault();
    
    if (kycStatus !== 'approved') {
      showMessage('KYC verification required', 'error');
      return;
    }
    
    if (!validateRentForm()) return;
    
    const submitBtn = document.getElementById('submitRentBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '‚è≥ Uploading...';
    
    const progress = document.getElementById('uploadProgress');
    const progressText = document.getElementById('progressText');
    const progressFill = document.getElementById('progressFill');
    
    progress.classList.add('active');
    
    try {
      const formData = collectRentFormData();
      
      progressText.textContent = 'Creating listing...';
      progressFill.style.width = '10%';
      
      const propertyRef = await firebase.firestore().collection('properties').add({
        ...formData,
        userId: currentUser.uid,
        ownerId: currentUser.uid,
        type: 'rent',
        status: 'available',
        createdAt: new Date(),
        updatedAt: new Date(),
        imageUrls: []
      });
      
      const propertyId = propertyRef.id;
      
      progressText.textContent = `Uploading ${selectedImages.length} image(s)...`;
      progressFill.style.width = '30%';
      
      const imageUrls = [];
      for (let i = 0; i < selectedImages.length; i++) {
        const file = selectedImages[i];
        const fileName = `${propertyId}_${Date.now()}_${i}`;
        const storageRef = firebase.storage().ref().child(`properties/${currentUser.uid}/${propertyId}/${fileName}`);
        
        const snapshot = await storageRef.put(file);
        const downloadURL = await snapshot.ref.getDownloadURL();
        imageUrls.push(downloadURL);
        
        const progressPercent = 30 + ((i + 1) / selectedImages.length) * 60;
        progressFill.style.width = `${progressPercent}%`;
      }
      
      progressText.textContent = 'Finalizing listing...';
      progressFill.style.width = '95%';
      
      await propertyRef.update({
        imageUrls: imageUrls,
        photos: imageUrls
      });
      
      progressFill.style.width = '100%';
      progressText.textContent = '‚úÖ Property posted successfully!';
      
      showMessage('‚úÖ Property posted successfully! Redirecting...', 'success');
      
      setTimeout(() => {
        window.location.href = 'my_properties.html';
      }, 2000);
      
    } catch (error) {
      console.error('Submission error:', error);
      showMessage(`Error: ${error.message}`, 'error');
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'üöÄ Post Property for Rent';
      progress.classList.remove('active');
    }
  }

  // ===== LEASE FORM SUBMISSION =====
  async function handleLeaseSubmit(event) {
    event.preventDefault();
    
    if (kycStatus !== 'approved') {
      showMessage('KYC verification required', 'error');
      return;
    }
    
    if (!validateLeaseForm()) return;
    
    const submitBtn = document.getElementById('submitLeaseBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '‚è≥ Uploading...';
    
    const progress = document.getElementById('leaseUploadProgress');
    const progressText = document.getElementById('leaseProgressText');
    const progressFill = document.getElementById('leaseProgressFill');
    
    progress.style.display = 'block';
    progressText.textContent = 'Preparing upload...';
    
    try {
      const formData = collectLeaseFormData();
      
      progressText.textContent = 'Creating lease listing...';
      progressFill.style.width = '10%';
      
      const propertyRef = await firebase.firestore().collection('properties').add({
        ...formData,
        userId: currentUser.uid,
        ownerId: currentUser.uid,
        type: 'lease',
        status: 'available',
        createdAt: new Date(),
        updatedAt: new Date(),
        imageUrls: []
      });
      
      const propertyId = propertyRef.id;
      
      progressText.textContent = `Uploading ${selectedLeaseImages.length} image(s)...`;
      progressFill.style.width = '30%';
      
      const imageUrls = [];
      for (let i = 0; i < selectedLeaseImages.length; i++) {
        const file = selectedLeaseImages[i];
        const fileName = `${propertyId}_${Date.now()}_${i}`;
        const storageRef = firebase.storage().ref().child(`properties/${currentUser.uid}/${propertyId}/${fileName}`);
        
        const snapshot = await storageRef.put(file);
        const downloadURL = await snapshot.ref.getDownloadURL();
        imageUrls.push(downloadURL);
        
        const progressPercent = 30 + ((i + 1) / selectedLeaseImages.length) * 60;
        progressFill.style.width = `${progressPercent}%`;
      }
      
      progressText.textContent = 'Finalizing lease listing...';
      progressFill.style.width = '95%';
      
      await propertyRef.update({
        imageUrls: imageUrls,
        photos: imageUrls
      });
      
      progressFill.style.width = '100%';
      progressText.textContent = '‚úÖ Lease property posted successfully!';
      
      showMessage('‚úÖ Lease property posted successfully! Redirecting...', 'success');
      
      setTimeout(() => {
        window.location.href = 'my_properties.html';
      }, 2000);
      
    } catch (error) {
      console.error('Lease submission error:', error);
      showMessage(`Error: ${error.message}`, 'error');
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'üìú Post Property for Lease';
      progress.style.display = 'none';
    }
  }

  // ===== FORM VALIDATION =====
  function validateRentForm() {
    const requiredFields = [
      'title', 'propertyCategory', 'propertyType', 'bedrooms', 'bathrooms',
      'floorArea', 'address', 'city', 'province', 'monthlyRent', 'minimumStay',
      'description'
    ];
    
    for (const fieldId of requiredFields) {
      const field = document.getElementById(fieldId);
      if (!field.value.trim()) {
        showMessage(`Please fill in ${field.previousElementSibling.textContent}`, 'error');
        field.focus();
        return false;
      }
    }
    
    if (!document.getElementById('latitude').value) {
      showMessage('Please select location on map', 'error');
      return false;
    }
    
    if (selectedImages.length === 0) {
      showMessage('Please upload at least 1 property image', 'error');
      return false;
    }
    
    return true;
  }

  function validateLeaseForm() {
    const requiredFields = [
      'leaseTitle', 'leasePropertyCategory', 'leasePropertyType', 'totalArea',
      'leaseDuration', 'annualRent',
      'leaseAddress', 'leaseCity', 'leaseProvince', 'leaseDescription'
    ];
    
    for (const fieldId of requiredFields) {
      const field = document.getElementById(fieldId);
      if (!field.value.trim()) {
        showMessage(`Please fill in ${field.previousElementSibling?.textContent || fieldId}`, 'error');
        field.focus();
        return false;
      }
    }
    
    if (!document.getElementById('leaseLatitude').value) {
      showMessage('Please select location on map', 'error');
      return false;
    }
    
    if (!selectedLeaseType) {
      showMessage('Please select a lease type', 'error');
      return false;
    }
    
    if (selectedLeaseImages.length === 0) {
      showMessage('Please upload at least 1 property image', 'error');
      return false;
    }
    
    return true;
  }

  // ===== FORM DATA COLLECTION =====
  function collectRentFormData() {
    const amenities = [];
    document.querySelectorAll('input[name="amenities"]:checked').forEach(checkbox => {
      amenities.push(checkbox.value);
    });
    
    const otherAmenities = document.getElementById('otherAmenities').value;
    if (otherAmenities) {
      otherAmenities.split(',').forEach(item => {
        const trimmed = item.trim();
        if (trimmed) amenities.push(trimmed);
      });
    }
    
    return {
      title: document.getElementById('title').value,
      propertyCategory: document.getElementById('propertyCategory').value,
      propertyType: document.getElementById('propertyType').value,
      bedrooms: document.getElementById('bedrooms').value,
      bathrooms: document.getElementById('bathrooms').value,
      floorArea: parseFloat(document.getElementById('floorArea').value),
      furnishing: document.getElementById('furnishing').value || null,
      address: document.getElementById('address').value,
      location: document.getElementById('address').value,
      city: document.getElementById('city').value,
      province: document.getElementById('province').value,
      latitude: parseFloat(document.getElementById('latitude').value),
      longitude: parseFloat(document.getElementById('longitude').value),
      monthlyRent: parseFloat(document.getElementById('monthlyRent').value),
      securityDeposit: document.getElementById('securityDeposit').value ? 
        parseFloat(document.getElementById('securityDeposit').value) : null,
      advanceRent: document.getElementById('advanceRent').value ? 
        parseInt(document.getElementById('advanceRent').value) : 1,
      minimumStay: parseInt(document.getElementById('minimumStay').value),
      amenities: amenities,
      description: document.getElementById('description').value
    };
  }

  function collectLeaseFormData() {
    const amenities = [];
    document.querySelectorAll('input[name="leaseAmenities"]:checked').forEach(checkbox => {
      amenities.push(checkbox.value);
    });
    
    const otherFeatures = document.getElementById('otherFeatures').value;
    if (otherFeatures) {
      otherFeatures.split(',').forEach(item => {
        const trimmed = item.trim();
        if (trimmed) amenities.push(trimmed);
      });
    }
    
    const utilities = document.getElementById('utilities').value;
    if (utilities) {
      utilities.split(',').forEach(item => {
        const trimmed = item.trim();
        if (trimmed) amenities.push(trimmed);
      });
    }
    
    return {
      title: document.getElementById('leaseTitle').value,
      propertyCategory: document.getElementById('leasePropertyCategory').value,
      propertyType: document.getElementById('leasePropertyType').value,
      totalArea: parseFloat(document.getElementById('totalArea').value),
      usableArea: document.getElementById('usableArea').value ? 
        parseFloat(document.getElementById('usableArea').value) : null,
      zoning: document.getElementById('zoning').value || null,
      leaseType: document.getElementById('leaseTypeInput').value,
      leaseDuration: parseInt(document.getElementById('leaseDuration').value),
      renewalOption: document.getElementById('renewalOption').value || null,
      annualRent: parseFloat(document.getElementById('annualRent').value),
      paymentTerms: document.getElementById('paymentTerms').value || null,
      securityBond: document.getElementById('securityBond').value ? 
        parseFloat(document.getElementById('securityBond').value) : null,
      advancePayment: document.getElementById('advancePayment').value ? 
        parseInt(document.getElementById('advancePayment').value) : 1,
      address: document.getElementById('leaseAddress').value,
      location: document.getElementById('leaseAddress').value,
      city: document.getElementById('leaseCity').value,
      province: document.getElementById('leaseProvince').value,
      latitude: parseFloat(document.getElementById('leaseLatitude').value),
      longitude: parseFloat(document.getElementById('leaseLongitude').value),
      frontage: document.getElementById('frontage').value ? 
        parseFloat(document.getElementById('frontage').value) : null,
      topography: document.getElementById('topography').value || null,
      accessRoad: document.getElementById('accessRoad').value || null,
      restrictions: document.getElementById('restrictions').value || null,
      maintenance: document.getElementById('maintenance').value || null,
      amenities: amenities,
      description: document.getElementById('leaseDescription').value,
      listingType: 'lease'
    };
  }

  // ===== UTILITY FUNCTIONS =====
  function showMessage(text, type) {
    const box = document.getElementById('messageBox');
    box.textContent = text;
    box.className = `message ${type}`;
    box.style.display = 'block';
    
    setTimeout(() => {
      box.style.display = 'none';
    }, 5000);
  }

  function resetRentForm() {
    if (confirm('Are you sure you want to reset the rent form? All entered data will be lost.')) {
      document.getElementById('rentalForm').reset();
      document.getElementById('previewContainer').innerHTML = '';
      selectedImages = [];
      updatePropertyTypes();
    }
  }

  function resetLeaseForm() {
    if (confirm('Are you sure you want to reset the lease form? All entered data will be lost.')) {
      document.getElementById('leasePropertyForm').reset();
      document.getElementById('leasePreviewContainer').innerHTML = '';
      selectedLeaseImages = [];
      selectedLeaseType = null;
      updateLeasePropertyTypes();
      
      document.querySelectorAll('.lease-option').forEach(option => {
        option.classList.remove('active');
      });
    }
  }

  function toggleMenu() {
    const navLeft = document.querySelector('.nav-left');
    const navRight = document.querySelector('.nav-right');
    const hamburger = document.querySelector('.hamburger');
    
    navLeft.classList.toggle('active');
    navRight.classList.toggle('active');
    hamburger.classList.toggle('open');
  }
</script>
</body>
</html>
