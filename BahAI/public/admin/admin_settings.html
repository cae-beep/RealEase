<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Settings - BahAI Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Copy all base styles from admin_user.html */
:root {
  --primary: #0b2e52;
  --primary-dark: #001F3F;
  --primary-light: #1976d2;
  --secondary: #3b82f6;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --text-dark: #1a202c;
  --text-light: #718096;
  --bg-light: #f8fafc;
  --bg-white: #ffffff;
  --border: #e2e8f0;
  --shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
  --sidebar-width: 260px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', Arial, sans-serif;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  color: var(--text-dark);
  display: flex;
  min-height: 100vh;
}

/* ==================== IMPROVED SIDEBAR STYLES ==================== */
.sidebar {
  width: var(--sidebar-width);
  height: 100vh;
  background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
  position: fixed;
  left: 0;
  top: 0;
  padding: 25px 0;
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
  overflow-y: auto;
  z-index: 1000;
  transition: var(--transition);
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  padding: 0 25px 30px;
  margin-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.logo {
  display: flex;
  align-items: center;
  gap: 14px;
  color: white;
  text-decoration: none;
  transition: var(--transition);
  padding: 10px;
  border-radius: 12px;
}

.logo:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-2px);
}

.logo-icon {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  font-size: 20px;
  color: var(--primary);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transition: var(--transition);
}

.logo:hover .logo-icon {
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.logo-text {
  display: flex;
  flex-direction: column;
  flex: 1;
}

.logo-title {
  font-size: 22px;
  font-weight: 800;
  line-height: 1.1;
  margin-bottom: 4px;
  letter-spacing: -0.3px;
  background: linear-gradient(135deg, #ffffff 0%, #e6f3ff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.logo-subtitle {
  font-size: 11px;
  opacity: 0.9;
  color: rgba(255, 255, 255, 0.8);
  font-weight: 500;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

/* Navigation */
.sidebar-nav {
  list-style: none;
  padding: 0;
  flex: 1;
}

.sidebar-nav li {
  margin: 5px 15px;
}

.sidebar-link {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 20px;
  color: rgba(255, 255, 255, 0.85);
  text-decoration: none;
  transition: var(--transition);
  font-weight: 500;
  font-size: 15px;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
}

.sidebar-link::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 4px;
  background: white;
  transform: translateX(-10px);
  transition: var(--transition);
  border-radius: 0 4px 4px 0;
}

.sidebar-link:hover {
  background: rgba(255, 255, 255, 0.12);
  color: white;
  transform: translateX(5px);
}

.sidebar-link:hover::before {
  transform: translateX(0);
}

.sidebar-link.active {
  background: rgba(255, 255, 255, 0.18);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.sidebar-link.active::before {
  transform: translateX(0);
  background: linear-gradient(135deg, #ffffff 0%, #3b82f6 100%);
  box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
}

.sidebar-icon {
  width: 22px;
  height: 22px;
  display: inline-block;
  font-size: 18px;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
}

.sidebar-link:hover .sidebar-icon {
  transform: scale(1.1);
}

.sidebar-link.active .sidebar-icon {
  transform: scale(1.1);
}

/* Logout button special styling */
.sidebar-nav li:last-child .sidebar-link {
  margin-top: 20px;
  background: rgba(239, 68, 68, 0.15);
  color: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.sidebar-nav li:last-child .sidebar-link:hover {
  background: rgba(239, 68, 68, 0.25);
  color: white;
  border-color: rgba(239, 68, 68, 0.5);
}

.sidebar-nav li:last-child .sidebar-link::before {
  background: var(--danger);
}

/* Sidebar footer */
.sidebar-footer {
  padding: 20px 25px 0;
  margin-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  font-size: 12px;
  color: rgba(255, 255, 255, 0.6);
  text-align: center;
}

.sidebar-footer a {
  color: rgba(255, 255, 255, 0.8);
  text-decoration: none;
  transition: var(--transition);
}

.sidebar-footer a:hover {
  color: white;
  text-decoration: underline;
}

/* Main container */
.container {
  flex: 1;
  margin-left: var(--sidebar-width);
  padding: 30px;
  transition: var(--transition);
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  flex-wrap: wrap;
  gap: 20px;
}

.header-left h1 {
  font-size: 32px;
  font-weight: 800;
  color: var(--text-dark);
  margin-bottom: 10px;
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.5px;
}

.header-left p {
  color: var(--text-light);
  font-size: 16px;
  max-width: 600px;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 15px;
}

/* Admin Profile Card */
.admin-profile-card {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  padding: 35px;
  border-radius: 24px;
  display: flex;
  align-items: center;
  gap: 25px;
  margin-bottom: 40px;
  box-shadow: 0 12px 32px rgba(11, 46, 82, 0.25);
  position: relative;
  overflow: hidden;
  transition: var(--transition);
}

.admin-profile-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 16px 40px rgba(11, 46, 82, 0.35);
}

.admin-profile-card::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 60%;
  height: 100%;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
  clip-path: polygon(100% 0, 0% 100%, 100% 100%);
  opacity: 0.5;
}

.admin-avatar-large {
  width: 100px;
  height: 100px;
  border-radius: 20px;
  background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  font-weight: 800;
  color: var(--primary);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
  flex-shrink: 0;
  position: relative;
  z-index: 1;
}

.admin-details {
  position: relative;
  z-index: 1;
  flex: 1;
}

.admin-details h2 {
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 8px;
  line-height: 1.2;
}

.admin-details p {
  opacity: 0.9;
  font-size: 15px;
  margin-bottom: 5px;
}

.admin-details p:last-child {
  margin-top: 10px;
  font-size: 14px;
  opacity: 0.8;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Settings Grid */
.settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 30px;
  margin-bottom: 40px;
}

.settings-card {
  background: white;
  border-radius: 24px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  overflow: hidden;
  transition: var(--transition);
  position: relative;
}

.settings-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--primary-light));
}

.settings-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
}

.settings-card-header {
  padding: 30px 30px 20px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, var(--bg-light) 0%, #e9f2ff 100%);
}

.settings-card-title {
  font-size: 22px;
  font-weight: 800;
  color: var(--text-dark);
  display: flex;
  align-items: center;
  gap: 12px;
}

.settings-card-title i {
  color: var(--primary-light);
  font-size: 24px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(11, 46, 82, 0.1);
  border-radius: 12px;
}

.settings-card-body {
  padding: 30px;
}

/* Form Styles */
.form-group {
  margin-bottom: 25px;
}

.form-label {
  display: block;
  font-weight: 700;
  color: var(--text-dark);
  margin-bottom: 12px;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-label i {
  color: var(--primary-light);
  width: 20px;
}

.form-input {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid var(--border);
  border-radius: 14px;
  font-size: 15px;
  font-family: 'Inter', sans-serif;
  transition: var(--transition);
  background: var(--bg-white);
  color: var(--text-dark);
}

.form-input:focus {
  outline: none;
  border-color: var(--primary);
  background: white;
  box-shadow: 0 0 0 4px rgba(11, 46, 82, 0.15);
}

.form-input:disabled {
  background: var(--bg-light);
  color: var(--text-light);
  cursor: not-allowed;
  border-color: var(--border);
}

/* Button Styles */
.btn {
  padding: 16px 32px;
  border: none;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  letter-spacing: 0.3px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

.btn:active {
  transform: translateY(-1px);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  color: white;
}

.btn-primary:hover {
  background: linear-gradient(135deg, var(--primary-dark), var(--primary));
}

.btn-secondary {
  background: linear-gradient(135deg, var(--secondary), #2563eb);
  color: white;
}

.btn-secondary:hover {
  background: linear-gradient(135deg, #1d4ed8, #1e40af);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
}

.btn-success:hover {
  background: linear-gradient(135deg, #059669, #047857);
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #dc2626);
  color: white;
}

.btn-danger:hover {
  background: linear-gradient(135deg, #dc2626, #b91c1c);
}

.btn-group {
  display: flex;
  gap: 15px;
  margin-top: 30px;
  flex-wrap: wrap;
}

.btn-group .btn {
  flex: 1;
  min-width: 150px;
}

/* Export Options */
.export-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 25px;
}

.export-option {
  background: var(--bg-light);
  border: 2px solid var(--border);
  border-radius: 18px;
  padding: 25px;
  transition: var(--transition);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.export-option:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
  background: white;
  border-color: var(--primary-light);
}

.export-option::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--primary-light));
  transform: scaleX(0);
  transform-origin: left;
  transition: var(--transition);
}

.export-option:hover::before {
  transform: scaleX(1);
}

.export-icon {
  width: 60px;
  height: 60px;
  border-radius: 16px;
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  margin-bottom: 20px;
  box-shadow: 0 6px 16px rgba(11, 46, 82, 0.2);
}

.export-title {
  font-weight: 800;
  color: var(--text-dark);
  margin-bottom: 10px;
  font-size: 17px;
}

.export-description {
  font-size: 14px;
  color: var(--text-light);
  line-height: 1.6;
}

/* Toast Notifications - Improved */
.toast {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background: white;
  color: var(--text-dark);
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 3000;
  animation: slideInRight 0.3s ease;
  border-left: 4px solid var(--primary);
  max-width: 350px;
}

.toast.success {
  border-left-color: var(--success);
}

.toast.error {
  border-left-color: var(--danger);
}

.toast.info {
  border-left-color: var(--secondary);
}

.toast.warning {
  border-left-color: var(--warning);
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 4000;
  display: none;
}

.loading-overlay.show {
  display: flex;
  animation: fadeIn 0.3s ease;
}

.loading-spinner {
  width: 70px;
  height: 70px;
  border: 4px solid rgba(11, 46, 82, 0.1);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Mobile Menu Toggle */
.mobile-menu-toggle {
  display: none;
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1001;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  width: 56px;
  height: 56px;
  border-radius: 14px;
  font-size: 24px;
  cursor: pointer;
  box-shadow: var(--shadow-lg);
  transition: var(--transition);
}

.mobile-menu-toggle:hover {
  transform: scale(1.1);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

/* Responsive Design */
@media (max-width: 1200px) {
  .settings-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 1024px) {
  .sidebar {
    transform: translateX(-100%);
    width: 300px;
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .container {
    margin-left: 0;
    padding: 25px;
  }

  .mobile-menu-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

@media (max-width: 768px) {
  .container {
    padding: 20px;
  }

  .dashboard-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .header-right {
    width: 100%;
    justify-content: flex-end;
  }

  .admin-profile-card {
    flex-direction: column;
    text-align: center;
    padding: 30px 25px;
  }

  .admin-details h2 {
    font-size: 24px;
  }

  .settings-grid {
    gap: 20px;
  }

  .settings-card {
    margin-bottom: 20px;
  }

  .settings-card-header,
  .settings-card-body {
    padding: 25px;
  }

  .export-options {
    grid-template-columns: 1fr;
  }

  .btn-group {
    flex-direction: column;
  }

  .btn-group .btn {
    width: 100%;
    min-width: auto;
  }

  .btn {
    padding: 14px 24px;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 15px;
  }

  .admin-profile-card {
    padding: 25px 20px;
  }

  .admin-avatar-large {
    width: 80px;
    height: 80px;
    font-size: 32px;
  }

  .settings-card-header,
  .settings-card-body {
    padding: 20px;
  }

  .form-input {
    padding: 14px 16px;
  }

  .toast {
    bottom: 20px;
    right: 15px;
    left: 15px;
    max-width: none;
  }
}
</style>
</head>

<body>
<button class="mobile-menu-toggle" id="mobileMenuToggle">
  <i class="fas fa-bars"></i>
</button>

<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
</div>

<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <a href="admin_dashboard.html" class="logo">
      <div class="logo-icon">BA</div>
      <div class="logo-text">
        <div class="logo-title">BahAI</div>
        <div class="logo-subtitle">Admin Dashboard</div>
      </div>
    </a>
  </div>

  <ul class="sidebar-nav">
    <li><a href="admin_dashboard.html" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-chart-line"></i></span>Dashboard Overview</a></li>
    <li><a href="admin_users.html" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-users"></i></span>User Management</a></li>
    <li><a href="admin_properties.html" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-building"></i></span>Property Listings</a></li>
    <li><a href="admin_analytics.html" class="sidebar-link"><span class="sidebar-icon"><i class="fas fa-chart-bar"></i></span>Reports & Analytics</a></li>
    <li><a href="admin_settings.html" class="sidebar-link active"><span class="sidebar-icon"><i class="fas fa-cog"></i></span>Settings</a></li>
    <li><a href="#" class="sidebar-link" onclick="logout()" id="logoutBtn"><span class="sidebar-icon"><i class="fas fa-sign-out-alt"></i></span>Logout</a></li>
  </ul>

  <div class="sidebar-footer">
    <div style="margin-bottom: 8px; opacity: 0.7;"></div>
    <div>Â© 2026 BahAI Admin</div>
  </div>
</div>

<div class="container">
  <div class="dashboard-header">
    <div class="header-left">
      <h1>Settings</h1>
      <p>Manage your admin profile and export data</p>
    </div>
    <div class="header-right">
      <button class="btn btn-secondary" onclick="refreshData()">
        <i class="fas fa-sync-alt"></i> Refresh Data
      </button>
    </div>
  </div>

  <div class="admin-profile-card">
    <div class="admin-avatar-large" id="adminAvatar">AD</div>
    <div class="admin-details">
      <h2 id="adminName">Administrator</h2>
      <p id="adminEmail">admin@bahai.com</p>
      <p><i class="fas fa-calendar-alt"></i> Last login: <span id="lastLogin">Today</span></p>
    </div>
  </div>

  <div class="settings-grid">
    <!-- Profile Settings Card -->
    <div class="settings-card">
      <div class="settings-card-header">
        <h3 class="settings-card-title">
          <i class="fas fa-user-cog"></i> Profile Settings
        </h3>
      </div>
      <div class="settings-card-body">
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-user"></i> Full Name
          </label>
          <input type="text" class="form-input" id="fullNameInput" placeholder="Enter your full name" />
        </div>
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-envelope"></i> Email Address
          </label>
          <input type="email" class="form-input" id="emailInput" value="admin@bahai.com" disabled />
        </div>
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-shield-alt"></i> Admin Role
          </label>
          <input type="text" class="form-input" value="System Administrator" disabled />
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="saveProfile()">
            <i class="fas fa-save"></i> Save Changes
          </button>
          
            <i ></i> 
          
        </div>
      </div>
    </div>
    
    <!-- Data Export Card -->
    <div class="settings-card">
      <div class="settings-card-header">
        <h3 class="settings-card-title">
          <i class="fas fa-database"></i> Data Export
        </h3>
      </div>
      <div class="settings-card-body">
        <p style="margin-bottom: 25px; color: var(--text-light); line-height: 1.6; font-size: 15px;">
          Export your data in various formats for backup, analysis, or migration purposes. 
          All exports are generated in real-time and include the latest data.
        </p>
        
        <div class="export-options">
          <div class="export-option" onclick="exportData('properties')">
            <div class="export-icon">
              <i class="fas fa-building"></i>
            </div>
            <div class="export-title">Properties Data</div>
            <div class="export-description">
              Export all property listings including details, prices, status, and images.
            </div>
          </div>
          
          <div class="export-option" onclick="exportData('users')">
            <div class="export-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="export-title">Users Data</div>
            <div class="export-description">
              Export all user accounts, profiles, and activity logs.
            </div>
          </div>
          
          <div class="export-option" onclick="exportData('analytics')">
            <div class="export-icon">
              <i class="fas fa-chart-bar"></i>
            </div>
            <div class="export-title">Analytics Data</div>
            <div class="export-description">
              Export analytics reports, statistics, and performance metrics.
            </div>
          </div>
          
          <div class="export-option" onclick="exportData('complete')">
            <div class="export-icon">
              <i class="fas fa-file-archive"></i>
            </div>
            <div class="export-title">Complete Backup</div>
            <div class="export-description">
              Full system backup including all data and settings in a single file.
            </div>
          </div>
        </div>
        
        <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid var(--border);">
          <div style="color: var(--text-light); font-size: 14px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 10px;">
            <i class="fas fa-info-circle" style="color: var(--secondary); margin-top: 3px;"></i>
            <span>Exports are generated in JSON format and can be imported back later. All exports include real-time data from the database.</span>
          </div>
          <div class="btn-group">
            <button class="btn btn-success" onclick="exportAllData()">
              <i class="fas fa-file-download"></i> Export Everything
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Toast notification function
function showToast(message, type = 'info', duration = 3000) {
  // Remove existing toast if any
  const existingToast = document.querySelector('.toast');
  if (existingToast) {
    existingToast.remove();
  }
  
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    ${type === 'success' ? '<i class="fas fa-check-circle" style="color: var(--success);"></i>' : 
      type === 'error' ? '<i class="fas fa-exclamation-circle" style="color: var(--danger);"></i>' : 
      type === 'warning' ? '<i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>' : 
      '<i class="fas fa-info-circle" style="color: var(--secondary);"></i>'}
    <span>${message}</span>
  `;
  
  document.body.appendChild(toast);
  
  // Auto remove after duration
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateX(100px)';
    setTimeout(() => {
      if (toast.parentNode) {
        document.body.removeChild(toast);
      }
    }, 300);
  }, duration);
}

// Show/hide loading overlay
function showLoading() {
  document.getElementById('loadingOverlay').classList.add('show');
}

function hideLoading() {
  document.getElementById('loadingOverlay').classList.remove('show');
}

// Logout function
function logout() {
  if (confirm('âš ï¸ Are you sure you want to logout?')) {
    localStorage.removeItem('adminLoggedIn');
    localStorage.removeItem('adminEmail');
    localStorage.removeItem('adminName');
    localStorage.removeItem('authTime');
    
    showToast('ðŸ”’ Logging out...', 'info');
    
    setTimeout(() => {
      window.location.href = 'admin_login.html';
    }, 1000);
  }
}

// Check if user is logged in
function checkAuth() {
  const isLoggedIn = localStorage.getItem('adminLoggedIn');
  const adminEmail = localStorage.getItem('adminEmail');
  const adminName = localStorage.getItem('adminName');
  const authTime = localStorage.getItem('authTime');
  
  if (!isLoggedIn || isLoggedIn !== 'true') {
    showToast('Please login first', 'warning');
    setTimeout(() => {
      window.location.href = 'admin_login.html';
    }, 1500);
    return false;
  }
  
  // Load admin information
  loadAdminInfo(adminEmail, adminName, authTime);
  
  return true;
}

function loadAdminInfo(email, name, authTime) {
  const adminEmail = email || 'admin@bahai.com';
  const adminName = name || 'Administrator';
  
  document.getElementById('adminName').textContent = adminName;
  document.getElementById('adminEmail').textContent = adminEmail;
  document.getElementById('fullNameInput').value = adminName;
  
  // Set avatar initials
  const initials = adminName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
  document.getElementById('adminAvatar').textContent = initials;
  
  // Format last login time
  if (authTime) {
    const lastLogin = new Date(parseInt(authTime));
    const now = new Date();
    const diffHours = Math.floor((now - lastLogin) / (1000 * 60 * 60));
    
    if (diffHours < 1) {
      const diffMinutes = Math.floor((now - lastLogin) / (1000 * 60));
      if (diffMinutes < 1) {
        document.getElementById('lastLogin').textContent = 'Just now';
      } else {
        document.getElementById('lastLogin').textContent = `${diffMinutes} minutes ago`;
      }
    } else if (diffHours < 24) {
      document.getElementById('lastLogin').textContent = `${diffHours} hours ago`;
    } else {
      const diffDays = Math.floor(diffHours / 24);
      document.getElementById('lastLogin').textContent = diffDays === 1 ? 'Yesterday' : `${diffDays} days ago`;
    }
  }
}

// Save profile function
async function saveProfile() {
  const fullName = document.getElementById('fullNameInput').value.trim();
  
  if (!fullName) {
    showToast('Please enter your full name', 'error');
    document.getElementById('fullNameInput').focus();
    return;
  }
  
  if (fullName.length < 2) {
    showToast('Name must be at least 2 characters long', 'error');
    return;
  }
  
  try {
    showLoading();
    
    // Update admin name in localStorage
    const oldName = localStorage.getItem('adminName') || 'Administrator';
    localStorage.setItem('adminName', fullName);
    
    // Update UI
    document.getElementById('adminName').textContent = fullName;
    const initials = fullName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
    document.getElementById('adminAvatar').textContent = initials;
    
    // Simulate API call delay
    await new Promise(resolve => setTimeout(resolve, 800));
    
    hideLoading();
    showToast(`âœ… Profile updated successfully! Changed from "${oldName}" to "${fullName}"`, 'success');
    
  } catch (error) {
    hideLoading();
    console.error('Error saving profile:', error);
    showToast('âŒ Failed to save profile. Please try again.', 'error');
  }
}

// Reset profile function
function resetProfile() {
  const savedName = localStorage.getItem('adminName');
  if (savedName) {
    document.getElementById('fullNameInput').value = savedName;
    showToast('Profile form reset to saved values', 'info');
  } else {
    document.getElementById('fullNameInput').value = '';
    showToast('Profile form cleared', 'info');
  }
}

// Refresh data function
function refreshData() {
  showLoading();
  setTimeout(() => {
    hideLoading();
    showToast('Data refreshed successfully', 'success');
  }, 800);
}

// Initialize Firebase for data export
let db;
let firebaseInitialized = false;

async function initializeFirebase() {
  try {
    // Dynamically import Firebase modules
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js");
    const { getFirestore, collection, getDocs, query, orderBy } = await import("https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js");
    
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCIfzneDzWVveG8p_0mywoA9D9F5AyzZX4",
      authDomain: "bahai-1b76d.firebaseapp.com",
      projectId: "bahai-1b76d",
      storageBucket: "bahai-1b76d.firebasestorage.app",
      messagingSenderId: "646878644941",
      appId: "1:646878644941:web:5b4ccc3412250337587784",
      measurementId: "G-PDW1PRZTM9"
    };
    
    const app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    firebaseInitialized = true;
    
    console.log('âœ… Firebase initialized for data export');
    return { collection, getDocs, query, orderBy };
    
  } catch (error) {
    console.error('âŒ Firebase initialization failed:', error);
    showToast('Failed to connect to database for data export', 'error');
    return null;
  }
}

async function fetchDataFromFirebase(collectionName) {
  if (!firebaseInitialized) {
    const firebase = await initializeFirebase();
    if (!firebase) {
      throw new Error('Firebase initialization failed');
    }
  }
  
  try {
    const { collection, getDocs, query, orderBy } = await import("https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js");
    
    const dataRef = collection(db, collectionName);
    const q = query(dataRef, orderBy('createdAt', 'desc'));
    const snapshot = await getDocs(q);
    
    const data = [];
    snapshot.forEach(doc => {
      const docData = doc.data();
      data.push({
        id: doc.id,
        ...docData
      });
    });
    
    return data;
  } catch (error) {
    console.error(`Error fetching ${collectionName}:`, error);
    throw error;
  }
}

async function exportData(type) {
  try {
    showLoading();
    
    let data = {};
    let filename = '';
    let exportMessage = '';
    
    switch(type) {
      case 'properties':
        data = await fetchDataFromFirebase('properties');
        filename = `bahai-properties-export-${new Date().toISOString().split('T')[0]}.json`;
        exportMessage = `âœ… Exported ${data.length} properties successfully`;
        break;
        
      case 'users':
        data = await fetchDataFromFirebase('users');
        filename = `bahai-users-export-${new Date().toISOString().split('T')[0]}.json`;
        exportMessage = `âœ… Exported ${data.length} users successfully`;
        break;
        
      case 'analytics':
        const propertiesData = await fetchDataFromFirebase('properties');
        const usersData = await fetchDataFromFirebase('users');
        data = {
          exportDate: new Date().toISOString(),
          summary: await generateAnalyticsSummary(propertiesData, usersData),
          adminProfile: {
            name: localStorage.getItem('adminName') || 'Administrator',
            email: localStorage.getItem('adminEmail') || 'admin@bahai.com'
          },
          systemStats: {
            totalProperties: propertiesData.length,
            totalUsers: usersData.length
          }
        };
        filename = `bahai-analytics-export-${new Date().toISOString().split('T')[0]}.json`;
        exportMessage = 'âœ… Analytics report generated successfully';
        break;
        
      case 'complete':
        const [properties, users] = await Promise.all([
          fetchDataFromFirebase('properties'),
          fetchDataFromFirebase('users')
        ]);
        
        data = {
          exportDate: new Date().toISOString(),
          properties: properties,
          users: users,
          analytics: await generateAnalyticsSummary(properties, users),
          adminProfile: {
            name: localStorage.getItem('adminName') || 'Administrator',
            email: localStorage.getItem('adminEmail') || 'admin@bahai.com',
            lastLogin: localStorage.getItem('authTime') || new Date().getTime()
          },
          systemInfo: {
            platform: 'BahAI Real Estate Admin',
            version: '2.0.1',
            exportType: 'complete_backup'
          }
        };
        filename = `bahai-complete-backup-${new Date().toISOString().split('T')[0]}.json`;
        exportMessage = `âœ… Complete backup with ${properties.length} properties and ${users.length} users`;
        break;
        
      default:
        throw new Error('Invalid export type');
    }
    
    // Create and trigger download
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Clean up
    setTimeout(() => URL.revokeObjectURL(url), 100);
    
    hideLoading();
    showToast(exportMessage, 'success');
    
  } catch (error) {
    hideLoading();
    console.error('Export error:', error);
    
    if (error.message.includes('Firebase initialization failed')) {
      showToast('Failed to connect to database. Please check your internet connection.', 'error');
    } else if (error.message.includes('collection is not defined')) {
      showToast('Database connection error. Please refresh the page and try again.', 'error');
    } else {
      showToast('Failed to export data. Please try again.', 'error');
    }
  }
}

async function exportAllData() {
  try {
    showLoading();
    
    // Initialize Firebase if not already initialized
    if (!firebaseInitialized) {
      await initializeFirebase();
    }
    
    // Fetch all data in parallel
    const [properties, users] = await Promise.all([
      fetchDataFromFirebase('properties').catch(() => []),
      fetchDataFromFirebase('users').catch(() => [])
    ]);
    
    const allData = {
      exportDate: new Date().toISOString(),
      properties,
      users,
      analytics: await generateAnalyticsSummary(properties, users),
      adminProfile: {
        name: localStorage.getItem('adminName') || 'Administrator',
        email: localStorage.getItem('adminEmail') || 'admin@bahai.com',
        lastLogin: localStorage.getItem('authTime') || new Date().getTime()
      },
      systemInfo: {
        platform: 'BahAI Real Estate',
        version: '2.0.1',
        exportType: 'complete_export',
        generatedBy: 'Admin Dashboard'
      }
    };
    
    // Create and trigger download
    const dataStr = JSON.stringify(allData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `bahai-complete-export-${new Date().toISOString().split('T')[0]}.json`;
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Clean up
    setTimeout(() => URL.revokeObjectURL(url), 100);
    
    hideLoading();
    showToast(`âœ… Exported ${properties.length} properties and ${users.length} users successfully!`, 'success');
    
  } catch (error) {
    hideLoading();
    console.error('Export all data error:', error);
    showToast('âŒ Failed to export all data. Please try again.', 'error');
  }
}

async function generateAnalyticsSummary(properties = [], users = []) {
  try {
    // Properties analytics
    const totalProperties = properties.length;
    const activeProperties = properties.filter(p => p.status === 'active').length;
    const pendingProperties = properties.filter(p => p.status === 'pending').length;
    const soldProperties = properties.filter(p => p.status === 'sold').length;
    
    const totalRevenue = properties
      .filter(p => p.status === 'sold')
      .reduce((sum, p) => sum + (parseFloat(p.price) || parseFloat(p.pricing) || 0), 0);
    
    const averagePrice = totalProperties > 0 
      ? properties.reduce((sum, p) => sum + (parseFloat(p.price) || parseFloat(p.pricing) || 0), 0) / totalProperties
      : 0;
    
    // Users analytics
    const totalUsers = users.length;
    const activeUsers = users.filter(u => u.active !== false && u.status !== 'inactive').length;
    
    // User roles distribution
    const roleCounts = {};
    users.forEach(u => {
      const role = u.role || 'user';
      roleCounts[role] = (roleCounts[role] || 0) + 1;
    });
    
    return {
      generatedAt: new Date().toISOString(),
      properties: {
        total: totalProperties,
        active: activeProperties,
        pending: pendingProperties,
        sold: soldProperties,
        totalRevenue: totalRevenue,
        averagePrice: averagePrice.toFixed(2)
      },
      users: {
        total: totalUsers,
        active: activeUsers,
        roles: roleCounts
      },
      system: {
        exportDate: new Date().toISOString(),
        admin: localStorage.getItem('adminName') || 'Administrator'
      }
    };
    
  } catch (error) {
    console.error('Error generating analytics summary:', error);
    return {
      generatedAt: new Date().toISOString(),
      error: 'Failed to generate analytics summary',
      details: error.message
    };
  }
}

// Mobile menu toggle
document.getElementById('mobileMenuToggle').addEventListener('click', function() {
  document.getElementById('sidebar').classList.toggle('active');
});

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
  const sidebar = document.getElementById('sidebar');
  const mobileMenuToggle = document.getElementById('mobileMenuToggle');
  
  if (window.innerWidth <= 1024 && 
      sidebar.classList.contains('active') && 
      !sidebar.contains(event.target) && 
      !mobileMenuToggle.contains(event.target)) {
    sidebar.classList.remove('active');
  }
});

// Close modals with Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    // Close mobile menu on mobile
    if (window.innerWidth <= 1024) {
      document.getElementById('sidebar').classList.remove('active');
    }
  }
});

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
  console.log('âš™ï¸ Settings page loaded');
  checkAuth();
  
  // Add keyboard shortcut for saving (Ctrl/Cmd + S)
  document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
      e.preventDefault();
      saveProfile();
    }
  });
});

// Export functions to global scope
window.logout = logout;
window.saveProfile = saveProfile;
window.resetProfile = resetProfile;
window.refreshData = refreshData;
window.exportData = exportData;
window.exportAllData = exportAllData;
</script>
</body>
</html>